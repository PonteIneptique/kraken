
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>API reference &#8212; kraken  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="canonical" href="kraken.re/api_docs.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Models" href="models.html" />
    <link rel="prev" title="API Quickstart" href="api.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="api-reference">
<h1>API reference<a class="headerlink" href="#api-reference" title="Permalink to this headline">¶</a></h1>
<section id="kraken-blla-module">
<h2>kraken.blla module<a class="headerlink" href="#kraken-blla-module" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><cite>blla</cite> provides the interface to the fully trainable segmenter. For the
legacy segmenter interface refer to the <cite>pageseg</cite> module. Note that
recognition models are not interchangeable between segmenters.</p>
</div>
<span class="target" id="module-kraken.blla"></span><section id="kraken-blla">
<h3>kraken.blla<a class="headerlink" href="#kraken-blla" title="Permalink to this headline">¶</a></h3>
<p>Trainable baseline layout analysis tools for kraken</p>
<dl class="py exception">
<dt class="sig sig-object py" id="kraken.blla.KrakenInputException">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.blla.</span></span><span class="sig-name descname"><span class="pre">KrakenInputException</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.blla.KrakenInputException" title="Permalink to this definition">¶</a></dt>
<dd><p>Common base class for all non-exit exceptions.</p>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="kraken.blla.KrakenInvalidModelException">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.blla.</span></span><span class="sig-name descname"><span class="pre">KrakenInvalidModelException</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.blla.KrakenInvalidModelException" title="Permalink to this definition">¶</a></dt>
<dd><p>Common base class for all non-exit exceptions.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.blla.calculate_polygonal_environment">
<span class="sig-prename descclassname"><span class="pre">kraken.blla.</span></span><span class="sig-name descname"><span class="pre">calculate_polygonal_environment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">baselines</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">suppl_obj</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">im_feats</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">topline</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.blla.calculate_polygonal_environment" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a list of baselines and an input image, calculates a polygonal
environment around each baseline.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>PIL.Image</em>) – grayscale input image (mode ‘L’)</p></li>
<li><p><strong>baselines</strong> (<em>sequence</em>) – List of lists containing a single baseline per
entry.</p></li>
<li><p><strong>suppl_obj</strong> (<em>sequence</em>) – List of lists containing additional polylines
that should be considered hard boundaries for
polygonizaton purposes. Can be used to prevent
polygonization into non-text areas such as
illustrations or to compute the polygonization of
a subset of the lines in an image.</p></li>
<li><p><strong>im_feats</strong> (<em>numpy.array</em>) – An optional precomputed seamcarve energy map.
Overrides data in <cite>im</cite>. The default map is
<cite>gaussian_filter(sobel(im), 2)</cite>.</p></li>
<li><p><strong>scale</strong> (<em>tuple</em>) – A 2-tuple (h, w) containing optional scale factors of
the input. Values of 0 are used for aspect-preserving
scaling. <cite>None</cite> skips input scaling.</p></li>
<li><p><strong>topline</strong> (<em>bool</em>) – Switch to change default baseline location for offset
calculation purposes. If set to False, baselines are
assumed to be on the bottom of the text line and will
be offset upwards, if set to True, baselines are on the
top and will be offset downwards. If set to None, no
offset will be applied.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>List of lists of coordinates. If no polygonization could be compute for
a baseline <cite>None</cite> is returned instead.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.blla.compute_segmentation_map">
<span class="sig-prename descclassname"><span class="pre">kraken.blla.</span></span><span class="sig-name descname"><span class="pre">compute_segmentation_map</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cpu'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.blla.compute_segmentation_map" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mask</strong> (<em>Optional</em><em>[</em><em>numpy.ndarray</em><em>]</em>) – </p></li>
<li><p><strong>device</strong> (<em>str</em>) – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.blla.get_im_str">
<span class="sig-prename descclassname"><span class="pre">kraken.blla.</span></span><span class="sig-name descname"><span class="pre">get_im_str</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.blla.get_im_str" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>im</strong> (<em>PIL.Image.Image</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.blla.is_bitonal">
<span class="sig-prename descclassname"><span class="pre">kraken.blla.</span></span><span class="sig-name descname"><span class="pre">is_bitonal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.blla.is_bitonal" title="Permalink to this definition">¶</a></dt>
<dd><p>Tests a PIL.Image for bitonality.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>im</strong> (<em>PIL.Image.Image</em>) – Image to test</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>True if the image contains only two different color values. False
otherwise.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="kraken.blla.logger">
<span class="sig-prename descclassname"><span class="pre">kraken.blla.</span></span><span class="sig-name descname"><span class="pre">logger</span></span><a class="headerlink" href="#kraken.blla.logger" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.blla.pil2array">
<span class="sig-prename descclassname"><span class="pre">kraken.blla.</span></span><span class="sig-name descname"><span class="pre">pil2array</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.blla.pil2array" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>PIL.Image.Image</em>) – </p></li>
<li><p><strong>alpha</strong> (<em>int</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.blla.polygonal_reading_order">
<span class="sig-prename descclassname"><span class="pre">kraken.blla.</span></span><span class="sig-name descname"><span class="pre">polygonal_reading_order</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lines</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">text_direction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'lr'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.blla.polygonal_reading_order" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a list of baselines and regions, calculates the correct reading order
and applies it to the input.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lines</strong> (<em>Sequence</em>) – List of tuples containing the baseline and its
polygonization.</p></li>
<li><p><strong>regions</strong> (<em>Sequence</em>) – List of region polygons.</p></li>
<li><p><strong>text_direction</strong> (<em>str</em>) – Set principal text direction for column ordering.
Can be ‘lr’ or ‘rl’</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A reordered input.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Sequence[Tuple[List[Tuple[int, int]], List[Tuple[int, int]]]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.blla.scale_polygonal_lines">
<span class="sig-prename descclassname"><span class="pre">kraken.blla.</span></span><span class="sig-name descname"><span class="pre">scale_polygonal_lines</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lines</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.blla.scale_polygonal_lines" title="Permalink to this definition">¶</a></dt>
<dd><p>Scales baselines/polygon coordinates by a certain factor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lines</strong> (<em>Sequence</em>) – List of tuples containing the baseline and it’s
polygonization.</p></li>
<li><p><strong>scale</strong> (<em>float</em><em> or </em><em>tuple of floats</em>) – Scaling factor</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>Sequence[Tuple[List, List]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.blla.scale_regions">
<span class="sig-prename descclassname"><span class="pre">kraken.blla.</span></span><span class="sig-name descname"><span class="pre">scale_regions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">regions</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.blla.scale_regions" title="Permalink to this definition">¶</a></dt>
<dd><p>Scales baselines/polygon coordinates by a certain factor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lines</strong> (<em>Sequence</em>) – List of tuples containing the baseline and it’s
polygonization.</p></li>
<li><p><strong>scale</strong> (<em>float</em><em> or </em><em>tuple of floats</em>) – Scaling factor</p></li>
<li><p><strong>regions</strong> (<em>Sequence</em><em>[</em><em>Tuple</em><em>[</em><em>List</em><em>[</em><em>int</em><em>]</em><em>, </em><em>List</em><em>[</em><em>int</em><em>]</em><em>]</em><em>]</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>Sequence[Tuple[List, List]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.blla.segment">
<span class="sig-prename descclassname"><span class="pre">kraken.blla.</span></span><span class="sig-name descname"><span class="pre">segment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">text_direction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'horizontal-lr'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reading_order_fn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">polygonal_reading_order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cpu'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.blla.segment" title="Permalink to this definition">¶</a></dt>
<dd><p>Segments a page into text lines using the baseline segmenter.</p>
<p>Segments a page into text lines and returns the polyline formed by each
baseline and their estimated environment.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>PIL.Image</em>) – An RGB image.</p></li>
<li><p><strong>text_direction</strong> (<em>str</em>) – Ignored by the segmenter but kept for
serialization.</p></li>
<li><p><strong>mask</strong> (<em>PIL.Image</em>) – A bi-level mask image of the same size as <cite>im</cite> where
0-valued regions are ignored for segmentation
purposes. Disables column detection.</p></li>
<li><p><strong>reading_order_fn</strong> (<em>function</em>) – Function to determine the reading order.
Has to accept a list of tuples (baselines,
polygon) and a text direction (<cite>lr</cite> or
<cite>rl</cite>).</p></li>
<li><p><strong>model</strong> (<a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel" title="kraken.lib.vgsl.TorchVGSLModel"><em>vgsl.TorchVGSLModel</em></a><em> or </em><em>list</em>) – One or more TorchVGSLModel
containing a segmentation model.
If none is given a default model
will be loaded.</p></li>
<li><p><strong>device</strong> (<em>str</em><em> or </em><em>torch.Device</em>) – The target device to run the neural
network on.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl>
<dt>‘$dir’,</dt><dd><p>’type’: ‘baseline’,
‘lines’: [</p>
<blockquote>
<div><blockquote>
<div><p>{‘baseline’: [[x0, y0], [x1, y1], …, [x_n, y_n]], ‘boundary’: [[x0, y0, x1, y1], … [x_m, y_m]]},
{‘baseline’: [[x0, …]], ‘boundary’: [[x0, …]]}</p>
</div></blockquote>
<p>]
‘regions’: [</p>
<blockquote>
<div><p>{‘region’: [[x0, y0], [x1, y1], …, [x_n, y_n]], ‘type’: ‘image’},
{‘region’: [[x0, …]], ‘type’: ‘text’}</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
</dd>
</dl>
<p>}: A dictionary containing the text direction and under the key ‘lines’
a list of reading order sorted baselines (polylines) and their
respective polygonal boundaries. The last and first point of each
boundary polygon is connected.</p>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>{‘text_direction’</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>KrakenInputException if the input image is not binarized</strong><strong> or </strong><strong>the text</strong> – </p></li>
<li><p><strong>direction is invalid.</strong> – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.blla.vec_lines">
<span class="sig-prename descclassname"><span class="pre">kraken.blla.</span></span><span class="sig-name descname"><span class="pre">vec_lines</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">heatmap</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cls_map</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">text_direction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'horizontal-lr'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reading_order_fn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">polygonal_reading_order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scal_im</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">suppl_obj</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">topline</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.blla.vec_lines" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes lines from a stack of heatmaps, a class mapping, and scaling
factor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>heatmap</strong> (<em>torch.Tensor</em>) – </p></li>
<li><p><strong>cls_map</strong> (<em>Dict</em>) – </p></li>
<li><p><strong>scale</strong> (<em>float</em>) – </p></li>
<li><p><strong>text_direction</strong> (<em>str</em>) – </p></li>
<li><p><strong>reading_order_fn</strong> (<em>Callable</em>) – </p></li>
<li><p><strong>regions</strong> (<em>List</em>) – </p></li>
<li><p><strong>scal_im</strong> (<em>numpy.ndarray</em>) – </p></li>
<li><p><strong>suppl_obj</strong> (<em>List</em>) – </p></li>
<li><p><strong>topline</strong> (<em>bool</em>) – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.blla.vec_regions">
<span class="sig-prename descclassname"><span class="pre">kraken.blla.</span></span><span class="sig-name descname"><span class="pre">vec_regions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">heatmap</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cls_map</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.blla.vec_regions" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes regions from a stack of heatmaps, a class mapping, and scaling
factor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>heatmap</strong> (<em>torch.Tensor</em>) – </p></li>
<li><p><strong>cls_map</strong> (<em>Dict</em>) – </p></li>
<li><p><strong>scale</strong> (<em>float</em>) – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.blla.vectorize_lines">
<span class="sig-prename descclassname"><span class="pre">kraken.blla.</span></span><span class="sig-name descname"><span class="pre">vectorize_lines</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.17</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_length</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.blla.vectorize_lines" title="Permalink to this definition">¶</a></dt>
<dd><p>Vectorizes lines from a binarized array.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>np.ndarray</em>) – Array of shape (3, H, W) with the first dimension
being probabilities for (start_separators,
end_separators, baseline).</p></li>
<li><p><strong>threshold</strong> (<em>float</em>) – Threshold for baseline blob detection.</p></li>
<li><p><strong>min_length</strong> (<em>int</em>) – Minimal length of output baselines.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>[[x0, y0, … xn, yn], [xm, ym, …, xk, yk], … ]
A list of lists containing the points of all baseline polylines.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.blla.vectorize_regions">
<span class="sig-prename descclassname"><span class="pre">kraken.blla.</span></span><span class="sig-name descname"><span class="pre">vectorize_regions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.blla.vectorize_regions" title="Permalink to this definition">¶</a></dt>
<dd><p>Vectorizes lines from a binarized array.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>np.ndarray</em>) – Array of shape (H, W) with the first dimension
being a probability distribution over the region.</p></li>
<li><p><strong>threshold</strong> (<em>float</em>) – Threshold for binarization</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>[[x0, y0, … xn, yn], [xm, ym, …, xk, yk], … ]
A list of lists containing the region polygons.</p>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="kraken-pageseg-module">
<h2>kraken.pageseg module<a class="headerlink" href="#kraken-pageseg-module" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><cite>pageseg</cite> is the legacy bounding box-based segmenter. For the trainable
baseline segmenter interface refer to the <cite>blla</cite> module. Note that
recognition models are not interchangeable between segmenters.</p>
</div>
<span class="target" id="module-kraken.pageseg"></span><section id="kraken-pageseg">
<h3>kraken.pageseg<a class="headerlink" href="#kraken-pageseg" title="Permalink to this headline">¶</a></h3>
<p>Layout analysis and script detection methods.</p>
<dl class="py exception">
<dt class="sig sig-object py" id="kraken.pageseg.KrakenInputException">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.pageseg.</span></span><span class="sig-name descname"><span class="pre">KrakenInputException</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.pageseg.KrakenInputException" title="Permalink to this definition">¶</a></dt>
<dd><p>Common base class for all non-exit exceptions.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.pageseg.binary_objects">
<span class="sig-prename descclassname"><span class="pre">kraken.pageseg.</span></span><span class="sig-name descname"><span class="pre">binary_objects</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">binary</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.pageseg.binary_objects" title="Permalink to this definition">¶</a></dt>
<dd><p>Labels features in an array and segments them into objects.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>binary</strong> (<em>numpy.ndarray</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.pageseg.compute_black_colseps">
<span class="sig-prename descclassname"><span class="pre">kraken.pageseg.</span></span><span class="sig-name descname"><span class="pre">compute_black_colseps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">binary</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxcolseps</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.pageseg.compute_black_colseps" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes column separators from vertical black lines.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>binary</strong> (<em>numpy.ndarray</em>) – Numpy array of the binary image</p></li>
<li><p><strong>scale</strong> (<em>float</em>) – </p></li>
<li><p><strong>maxcolseps</strong> (<em>int</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>(colseps, binary)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.pageseg.compute_boxmap">
<span class="sig-prename descclassname"><span class="pre">kraken.pageseg.</span></span><span class="sig-name descname"><span class="pre">compute_boxmap</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">binary</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0.5,</span> <span class="pre">4)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'i'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.pageseg.compute_boxmap" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns grapheme cluster-like boxes based on connected components.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>binary</strong> (<em>numpy.ndarray</em>) – </p></li>
<li><p><strong>scale</strong> (<em>float</em>) – </p></li>
<li><p><strong>threshold</strong> (<em>Tuple</em><em>[</em><em>float</em><em>, </em><em>int</em><em>]</em>) – </p></li>
<li><p><strong>dtype</strong> (<em>str</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.pageseg.compute_colseps_conv">
<span class="sig-prename descclassname"><span class="pre">kraken.pageseg.</span></span><span class="sig-name descname"><span class="pre">compute_colseps_conv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">binary</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minheight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxcolseps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.pageseg.compute_colseps_conv" title="Permalink to this definition">¶</a></dt>
<dd><p>Find column separators by convolution and thresholding.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>binary</strong> (<em>numpy.ndarray</em>) – </p></li>
<li><p><strong>scale</strong> (<em>float</em>) – </p></li>
<li><p><strong>minheight</strong> (<em>int</em>) – </p></li>
<li><p><strong>maxcolseps</strong> (<em>int</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Separators</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.pageseg.compute_gradmaps">
<span class="sig-prename descclassname"><span class="pre">kraken.pageseg.</span></span><span class="sig-name descname"><span class="pre">compute_gradmaps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">binary</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gauss</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.pageseg.compute_gradmaps" title="Permalink to this definition">¶</a></dt>
<dd><p>Use gradient filtering to find baselines</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>binary</strong> (<em>numpy.ndarray</em>) – </p></li>
<li><p><strong>scale</strong> (<em>float</em>) – </p></li>
<li><p><strong>gauss</strong> (<em>bool</em>) – Use gaussian instead of uniform filtering</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>(bottom, top, boxmap)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.pageseg.compute_line_seeds">
<span class="sig-prename descclassname"><span class="pre">kraken.pageseg.</span></span><span class="sig-name descname"><span class="pre">compute_line_seeds</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">binary</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bottom</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">top</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">colseps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.pageseg.compute_line_seeds" title="Permalink to this definition">¶</a></dt>
<dd><p>Base on gradient maps, computes candidates for baselines and xheights.
Then, it marks the regions between the two as a line seed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>binary</strong> (<em>numpy.ndarray</em>) – </p></li>
<li><p><strong>bottom</strong> (<em>numpy.ndarray</em>) – </p></li>
<li><p><strong>top</strong> (<em>numpy.ndarray</em>) – </p></li>
<li><p><strong>colseps</strong> (<em>numpy.ndarray</em>) – </p></li>
<li><p><strong>scale</strong> (<em>float</em>) – </p></li>
<li><p><strong>threshold</strong> (<em>float</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.pageseg.compute_lines">
<span class="sig-prename descclassname"><span class="pre">kraken.pageseg.</span></span><span class="sig-name descname"><span class="pre">compute_lines</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">segmentation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.pageseg.compute_lines" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a line segmentation map, computes a list
of tuples consisting of 2D slices and masked images.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>segmentation</strong> (<em>numpy.ndarray</em>) – </p></li>
<li><p><strong>scale</strong> (<em>float</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>List[<a class="reference internal" href="#kraken.pageseg.record" title="kraken.pageseg.record">record</a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.pageseg.compute_separators_morph">
<span class="sig-prename descclassname"><span class="pre">kraken.pageseg.</span></span><span class="sig-name descname"><span class="pre">compute_separators_morph</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">binary</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sepwiden</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxcolseps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.pageseg.compute_separators_morph" title="Permalink to this definition">¶</a></dt>
<dd><p>Finds vertical black lines corresponding to column separators.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>binary</strong> (<em>numpy.ndarray</em>) – </p></li>
<li><p><strong>scale</strong> (<em>float</em>) – </p></li>
<li><p><strong>sepwiden</strong> (<em>int</em>) – </p></li>
<li><p><strong>maxcolseps</strong> (<em>int</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.pageseg.compute_white_colseps">
<span class="sig-prename descclassname"><span class="pre">kraken.pageseg.</span></span><span class="sig-name descname"><span class="pre">compute_white_colseps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">binary</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxcolseps</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.pageseg.compute_white_colseps" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes column separators either from vertical black lines or whitespace.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>binary</strong> (<em>numpy.ndarray</em>) – Numpy array of the binary image</p></li>
<li><p><strong>scale</strong> (<em>float</em>) – </p></li>
<li><p><strong>maxcolseps</strong> (<em>int</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>colseps</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.pageseg.estimate_scale">
<span class="sig-prename descclassname"><span class="pre">kraken.pageseg.</span></span><span class="sig-name descname"><span class="pre">estimate_scale</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">binary</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.pageseg.estimate_scale" title="Permalink to this definition">¶</a></dt>
<dd><p>Estimates image scale based on number of connected components.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>binary</strong> (<em>numpy.ndarray</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.pageseg.find">
<span class="sig-prename descclassname"><span class="pre">kraken.pageseg.</span></span><span class="sig-name descname"><span class="pre">find</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">condition</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.pageseg.find" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the indices where ravel(condition) is true</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.pageseg.get_im_str">
<span class="sig-prename descclassname"><span class="pre">kraken.pageseg.</span></span><span class="sig-name descname"><span class="pre">get_im_str</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.pageseg.get_im_str" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>im</strong> (<em>PIL.Image.Image</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.pageseg.is_bitonal">
<span class="sig-prename descclassname"><span class="pre">kraken.pageseg.</span></span><span class="sig-name descname"><span class="pre">is_bitonal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.pageseg.is_bitonal" title="Permalink to this definition">¶</a></dt>
<dd><p>Tests a PIL.Image for bitonality.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>im</strong> (<em>PIL.Image.Image</em>) – Image to test</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>True if the image contains only two different color values. False
otherwise.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="kraken.pageseg.logger">
<span class="sig-prename descclassname"><span class="pre">kraken.pageseg.</span></span><span class="sig-name descname"><span class="pre">logger</span></span><a class="headerlink" href="#kraken.pageseg.logger" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.pageseg.norm_max">
<span class="sig-prename descclassname"><span class="pre">kraken.pageseg.</span></span><span class="sig-name descname"><span class="pre">norm_max</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">v</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.pageseg.norm_max" title="Permalink to this definition">¶</a></dt>
<dd><p>Normalizes the input array by maximum value.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>v</strong> (<em>numpy.ndarray</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.pageseg.pil2array">
<span class="sig-prename descclassname"><span class="pre">kraken.pageseg.</span></span><span class="sig-name descname"><span class="pre">pil2array</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.pageseg.pil2array" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>PIL.Image.Image</em>) – </p></li>
<li><p><strong>alpha</strong> (<em>int</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.pageseg.reading_order">
<span class="sig-prename descclassname"><span class="pre">kraken.pageseg.</span></span><span class="sig-name descname"><span class="pre">reading_order</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lines</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">text_direction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'lr'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.pageseg.reading_order" title="Permalink to this definition">¶</a></dt>
<dd><p>Given the list of lines (a list of 2D slices), computes
the partial reading order.  The output is a binary 2D array
such that order[i,j] is true if line i comes before line j
in reading order.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lines</strong> (<em>Sequence</em><em>[</em><em>Tuple</em><em>[</em><em>slice</em><em>, </em><em>slice</em><em>]</em><em>]</em>) – </p></li>
<li><p><strong>text_direction</strong> (<em>str</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.pageseg.record">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.pageseg.</span></span><span class="sig-name descname"><span class="pre">record</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.pageseg.record" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple dict-like object.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.pageseg.remove_hlines">
<span class="sig-prename descclassname"><span class="pre">kraken.pageseg.</span></span><span class="sig-name descname"><span class="pre">remove_hlines</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">binary</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxsize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.pageseg.remove_hlines" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes horizontal black lines that only interfere with page segmentation.</p>
<blockquote>
<div><dl class="simple">
<dt>Args:</dt><dd><p>binary (numpy.ndarray):
scale (float):
maxsize (int): maximum size of removed lines</p>
</dd>
<dt>Returns:</dt><dd><p>numpy.ndarray containing the filtered image.</p>
</dd>
</dl>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>binary</strong> (<em>numpy.ndarray</em>) – </p></li>
<li><p><strong>scale</strong> (<em>float</em>) – </p></li>
<li><p><strong>maxsize</strong> (<em>int</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.pageseg.rotate_lines">
<span class="sig-prename descclassname"><span class="pre">kraken.pageseg.</span></span><span class="sig-name descname"><span class="pre">rotate_lines</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lines</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">angle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">offset</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.pageseg.rotate_lines" title="Permalink to this definition">¶</a></dt>
<dd><p>Rotates line bounding boxes around the origin and adding and offset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lines</strong> (<em>numpy.ndarray</em>) – </p></li>
<li><p><strong>angle</strong> (<em>float</em>) – </p></li>
<li><p><strong>offset</strong> (<em>int</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.pageseg.segment">
<span class="sig-prename descclassname"><span class="pre">kraken.pageseg.</span></span><span class="sig-name descname"><span class="pre">segment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">text_direction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'horizontal-lr'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxcolseps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">black_colseps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">no_hlines</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pad</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reading_order_fn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">reading_order</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.pageseg.segment" title="Permalink to this definition">¶</a></dt>
<dd><p>Segments a page into text lines.</p>
<p>Segments a page into text lines and returns the absolute coordinates of
each line in reading order.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>PIL.Image</em>) – A bi-level page of mode ‘1’ or ‘L’</p></li>
<li><p><strong>text_direction</strong> (<em>str</em>) – Principal direction of the text
(horizontal-lr/rl/vertical-lr/rl)</p></li>
<li><p><strong>scale</strong> (<em>float</em>) – Scale of the image</p></li>
<li><p><strong>maxcolseps</strong> (<em>int</em>) – Maximum number of whitespace column separators</p></li>
<li><p><strong>black_colseps</strong> (<em>bool</em>) – Whether column separators are assumed to be
vertical black lines or not</p></li>
<li><p><strong>no_hlines</strong> (<em>bool</em>) – Switch for horizontal line removal</p></li>
<li><p><strong>pad</strong> (<em>int</em><em> or </em><em>tuple</em>) – Padding to add to line bounding boxes. If int the
same padding is used both left and right. If a
2-tuple, uses (padding_left, padding_right).</p></li>
<li><p><strong>mask</strong> (<em>PIL.Image</em>) – A bi-level mask image of the same size as <cite>im</cite> where
0-valued regions are ignored for segmentation
purposes. Disables column detection.</p></li>
<li><p><strong>reading_order_fn</strong> (<em>Callable</em>) – Function to call to order line output.
Callable accepting a list of slices (y, x)
and a text direction in (<cite>rl</cite>, <cite>lr</cite>).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>‘$dir’, ‘boxes’: [(x1, y1, x2, y2),…]}: A
dictionary containing the text direction and a list of reading order
sorted bounding boxes under the key ‘boxes’.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>{‘text_direction’</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>KrakenInputException if the input image is not binarized</strong><strong> or </strong><strong>the text</strong> – </p></li>
<li><p><strong>direction is invalid.</strong> – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.pageseg.topsort">
<span class="sig-prename descclassname"><span class="pre">kraken.pageseg.</span></span><span class="sig-name descname"><span class="pre">topsort</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">order</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.pageseg.topsort" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a binary array defining a partial order (o[i,j]==True means i&lt;j),
compute a topological sort.  This is a quick and dirty implementation
that works for up to a few thousand elements.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>order</strong> (<em>numpy.ndarray</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>List[int]</p>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="module-kraken.rpred">
<span id="kraken-rpred-module"></span><h2>kraken.rpred module<a class="headerlink" href="#module-kraken.rpred" title="Permalink to this headline">¶</a></h2>
<section id="kraken-rpred">
<h3>kraken.rpred<a class="headerlink" href="#kraken-rpred" title="Permalink to this headline">¶</a></h3>
<p>Generators for recognition on lines images.</p>
<dl class="py exception">
<dt class="sig sig-object py" id="kraken.rpred.KrakenInputException">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.rpred.</span></span><span class="sig-name descname"><span class="pre">KrakenInputException</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.rpred.KrakenInputException" title="Permalink to this definition">¶</a></dt>
<dd><p>Common base class for all non-exit exceptions.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.rpred.TorchSeqRecognizer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.rpred.</span></span><span class="sig-name descname"><span class="pre">TorchSeqRecognizer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decoder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">kraken.lib.ctc_decoder.greedy_decoder</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cpu'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.rpred.TorchSeqRecognizer" title="Permalink to this definition">¶</a></dt>
<dd><p>A class wrapping a TorchVGSLModel with a more comfortable recognition interface.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>train</strong> (<em>bool</em>) – </p></li>
<li><p><strong>device</strong> (<em>str</em>) – </p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="kraken.rpred.TorchSeqRecognizer.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">line</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.rpred.TorchSeqRecognizer.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs a forward pass on a torch tensor of one or more lines with
shape (N, C, H, W) and returns a numpy array (N, W, C).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>line</strong> (<em>torch.Tensor</em>) – NCHW line tensor</p></li>
<li><p><strong>lens</strong> (<em>torch.Tensor</em>) – Optional tensor containing sequence lengths if N &gt; 1</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Tuple with (N, W, C) shaped numpy array and final output sequence
lengths.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.rpred.TorchSeqRecognizer.predict">
<span class="sig-name descname"><span class="pre">predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">line</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.rpred.TorchSeqRecognizer.predict" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs a forward pass on a torch tensor of a line with shape (N, C, H, W)
and returns the decoding as a list of tuples (string, start, end,
confidence).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>line</strong> (<em>torch.Tensor</em>) – NCHW line tensor</p></li>
<li><p><strong>lens</strong> (<em>torch.Tensor</em>) – Optional tensor containing sequence lengths if N &gt; 1</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>List of decoded sequences.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>List[List[Tuple[str, int, int, float]]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.rpred.TorchSeqRecognizer.predict_labels">
<span class="sig-name descname"><span class="pre">predict_labels</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">line</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.rpred.TorchSeqRecognizer.predict_labels" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs a forward pass on a torch tensor of a line with shape (N, C, H, W)
and returns a list of tuples (class, start, end, max). Max is the
maximum value of the softmax layer in the region.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>line</strong> (<em>torch.tensor</em>) – </p></li>
<li><p><strong>lens</strong> (<em>torch.Tensor</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>List[List[Tuple[int, int, int, float]]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.rpred.TorchSeqRecognizer.predict_string">
<span class="sig-name descname"><span class="pre">predict_string</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">line</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.rpred.TorchSeqRecognizer.predict_string" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs a forward pass on a torch tensor of a line with shape (N, C, H, W)
and returns a string of the results.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>line</strong> (<em>torch.Tensor</em>) – </p></li>
<li><p><strong>lens</strong> (<em>torch.Tensor</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>List[str]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.rpred.TorchSeqRecognizer.to">
<span class="sig-name descname"><span class="pre">to</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.rpred.TorchSeqRecognizer.to" title="Permalink to this definition">¶</a></dt>
<dd><p>Moves model to device and automatically loads input tensors onto it.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.rpred.bidi_record">
<span class="sig-prename descclassname"><span class="pre">kraken.rpred.</span></span><span class="sig-name descname"><span class="pre">bidi_record</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">record</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">base_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.rpred.bidi_record" title="Permalink to this definition">¶</a></dt>
<dd><p>Reorders a record using the Unicode BiDi algorithm.</p>
<p>Models trained for RTL or mixed scripts still emit classes in LTR order
requiring reordering for proper display.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>record</strong> (<a class="reference internal" href="#kraken.rpred.ocr_record" title="kraken.rpred.ocr_record"><em>kraken.rpred.ocr_record</em></a>) – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>kraken.rpred.ocr_record</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#kraken.rpred.ocr_record" title="kraken.rpred.ocr_record">ocr_record</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.rpred.compute_polygon_section">
<span class="sig-prename descclassname"><span class="pre">kraken.rpred.</span></span><span class="sig-name descname"><span class="pre">compute_polygon_section</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">baseline</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">boundary</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.rpred.compute_polygon_section" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a baseline, polygonal boundary, and two points on the baseline return
the rectangle formed by the orthogonal cuts on that baseline segment. The
resulting polygon is not garantueed to have a non-zero area.</p>
<p>The distance can be larger than the actual length of the baseline if the
baseline endpoints are inside the bounding polygon. In that case the
baseline will be extrapolated to the polygon edge.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>baseline</strong> (<em>list</em>) – A polyline ((x1, y1), …, (xn, yn))</p></li>
<li><p><strong>boundary</strong> (<em>list</em>) – A bounding polygon around the baseline (same format as
baseline).</p></li>
<li><p><strong>dist1</strong> (<em>int</em>) – Absolute distance along the baseline of the first point.</p></li>
<li><p><strong>dist2</strong> (<em>int</em>) – Absolute distance along the baseline of the second point.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A sequence of polygon points.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.rpred.extract_polygons">
<span class="sig-prename descclassname"><span class="pre">kraken.rpred.</span></span><span class="sig-name descname"><span class="pre">extract_polygons</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bounds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.rpred.extract_polygons" title="Permalink to this definition">¶</a></dt>
<dd><p>Yields the subimages of image im defined in the list of bounding polygons
with baselines preserving order.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>PIL.Image.Image</em>) – Input image</p></li>
<li><p><strong>bounds</strong> (<em>list</em>) – A list of tuples (x1, y1, x2, y2)</p></li>
</ul>
</dd>
<dt class="field-even">Yields</dt>
<dd class="field-even"><p>(PIL.Image.Image) the extracted subimage</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>PIL.Image.Image</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.rpred.generate_input_transforms">
<span class="sig-prename descclassname"><span class="pre">kraken.rpred.</span></span><span class="sig-name descname"><span class="pre">generate_input_transforms</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">height</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">width</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pad</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">valid_norm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_binarization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.rpred.generate_input_transforms" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a torchvision transformation converting a PIL.Image into a
tensor usable in a network forward pass.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>batch</strong> (<em>int</em>) – mini-batch size</p></li>
<li><p><strong>height</strong> (<em>int</em>) – height of input image in pixels</p></li>
<li><p><strong>width</strong> (<em>int</em>) – width of input image in pixels</p></li>
<li><p><strong>channels</strong> (<em>int</em>) – color channels of input</p></li>
<li><p><strong>pad</strong> (<em>int</em>) – Amount of padding on horizontal ends of image</p></li>
<li><p><strong>valid_norm</strong> (<em>bool</em>) – Enables/disables baseline normalization as a valid
preprocessing step. If disabled we will fall back to
standard scaling.</p></li>
<li><p><strong>force_binarization</strong> (<em>bool</em>) – Forces binarization of input images using
the nlbin algorithm.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A torchvision transformation composition converting the input image to
the appropriate tensor.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>torchvision.transforms.Compose</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.rpred.get_im_str">
<span class="sig-prename descclassname"><span class="pre">kraken.rpred.</span></span><span class="sig-name descname"><span class="pre">get_im_str</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.rpred.get_im_str" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>im</strong> (<em>PIL.Image.Image</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.rpred.is_bitonal">
<span class="sig-prename descclassname"><span class="pre">kraken.rpred.</span></span><span class="sig-name descname"><span class="pre">is_bitonal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.rpred.is_bitonal" title="Permalink to this definition">¶</a></dt>
<dd><p>Tests a PIL.Image for bitonality.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>im</strong> (<em>PIL.Image.Image</em>) – Image to test</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>True if the image contains only two different color values. False
otherwise.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="kraken.rpred.logger">
<span class="sig-prename descclassname"><span class="pre">kraken.rpred.</span></span><span class="sig-name descname"><span class="pre">logger</span></span><a class="headerlink" href="#kraken.rpred.logger" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.rpred.mm_rpred">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.rpred.</span></span><span class="sig-name descname"><span class="pre">mm_rpred</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bounds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pad</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">16</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bidi_reordering</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">script_ignore</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.rpred.mm_rpred" title="Permalink to this definition">¶</a></dt>
<dd><p>Multi-model version of kraken.rpred.rpred</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>nets</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><a class="reference internal" href="#kraken.lib.models.TorchSeqRecognizer" title="kraken.lib.models.TorchSeqRecognizer"><em>kraken.lib.models.TorchSeqRecognizer</em></a><em>]</em>) – </p></li>
<li><p><strong>im</strong> (<em>PIL.Image.Image</em>) – </p></li>
<li><p><strong>bounds</strong> (<em>dict</em>) – </p></li>
<li><p><strong>pad</strong> (<em>int</em>) – </p></li>
<li><p><strong>bidi_reordering</strong> (<em>Union</em><em>[</em><em>bool</em><em>, </em><em>str</em><em>]</em>) – </p></li>
<li><p><strong>script_ignore</strong> (<em>Optional</em><em>[</em><em>List</em><em>[</em><em>str</em><em>]</em><em>]</em>) – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.rpred.ocr_record">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.rpred.</span></span><span class="sig-name descname"><span class="pre">ocr_record</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">prediction</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cuts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">confidences</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">line</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.rpred.ocr_record" title="Permalink to this definition">¶</a></dt>
<dd><p>A record object containing the recognition result of a single line</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prediction</strong> (<em>str</em>) – </p></li>
<li><p><strong>confidences</strong> (<em>List</em><em>[</em><em>float</em><em>]</em>) – </p></li>
<li><p><strong>line</strong> (<em>Union</em><em>[</em><em>List</em><em>, </em><em>Dict</em><em>[</em><em>str</em><em>, </em><em>List</em><em>]</em><em>]</em>) – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.rpred.rpred">
<span class="sig-prename descclassname"><span class="pre">kraken.rpred.</span></span><span class="sig-name descname"><span class="pre">rpred</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">network</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bounds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pad</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">16</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bidi_reordering</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.rpred.rpred" title="Permalink to this definition">¶</a></dt>
<dd><p>Uses a TorchSeqRecognizer and a segmentation to recognize text</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>network</strong> (<a class="reference internal" href="#kraken.lib.models.TorchSeqRecognizer" title="kraken.lib.models.TorchSeqRecognizer"><em>kraken.lib.models.TorchSeqRecognizer</em></a>) – A TorchSegRecognizer
object</p></li>
<li><p><strong>im</strong> (<em>PIL.Image.Image</em>) – Image to extract text from</p></li>
<li><p><strong>bounds</strong> (<em>dict</em>) – A dictionary containing a ‘boxes’ entry with a list of
coordinates (x0, y0, x1, y1) of a text line in the image
and an entry ‘text_direction’ containing
‘horizontal-lr/rl/vertical-lr/rl’.</p></li>
<li><p><strong>pad</strong> (<em>int</em>) – Extra blank padding to the left and right of text line.
Auto-disabled when expected network inputs are incompatible
with padding.</p></li>
<li><p><strong>bidi_reordering</strong> (<em>bool</em><em>|</em><em>str</em>) – Reorder classes in the ocr_record according to
the Unicode bidirectional algorithm for correct
display. Set to L|R to change base text
direction.</p></li>
</ul>
</dd>
<dt class="field-even">Yields</dt>
<dd class="field-even"><p>An ocr_record containing the recognized text, absolute character
positions, and confidence values for each character.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Generator[<a class="reference internal" href="#kraken.rpred.ocr_record" title="kraken.rpred.ocr_record">ocr_record</a>, None, None]</p>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="module-kraken.serialization">
<span id="kraken-serialization-module"></span><h2>kraken.serialization module<a class="headerlink" href="#module-kraken.serialization" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="kraken.serialization.is_in_region">
<span class="sig-prename descclassname"><span class="pre">kraken.serialization.</span></span><span class="sig-name descname"><span class="pre">is_in_region</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">line</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">region</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.serialization.is_in_region" title="Permalink to this definition">¶</a></dt>
<dd><p>Tests if a line is inside a region, i.e. if the mid point of the baseline
is inside the region.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>line</strong> (<em>geom.LineString</em>) – line to test</p></li>
<li><p><strong>region</strong> (<em>geom.Polygon</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>False if line is not inside region, True otherwise</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="kraken.serialization.logger">
<span class="sig-prename descclassname"><span class="pre">kraken.serialization.</span></span><span class="sig-name descname"><span class="pre">logger</span></span><a class="headerlink" href="#kraken.serialization.logger" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.serialization.make_printable">
<span class="sig-prename descclassname"><span class="pre">kraken.serialization.</span></span><span class="sig-name descname"><span class="pre">make_printable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">char</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.serialization.make_printable" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes a Unicode code point and return a printable representation of it.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>char</strong> (<em>str</em>) – Input code point</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Either the original code point, the name of the code point if it is a
combining mark, whitespace etc., or the hex code if it is a control
symbol.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.serialization.max_bbox">
<span class="sig-prename descclassname"><span class="pre">kraken.serialization.</span></span><span class="sig-name descname"><span class="pre">max_bbox</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">boxes</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.serialization.max_bbox" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the minimal bounding box containing all contained in an
iterator.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>boxes</strong> (<em>iterator</em>) – An iterator returning tuples of the format ((x0, y0),</p></li>
<li><p><strong>(</strong><strong>x1</strong> (<em>xn</em><em>, </em><em>yn</em><em>)</em>) – </p></li>
<li><p><strong>y1</strong><strong>)</strong> (<em>xn</em><em>, </em><em>yn</em><em>)</em>) – </p></li>
<li><p><strong>...</strong> (<em>xn</em><em>, </em><em>yn</em><em>)</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A box (x0, y0, x1, y1) covering all bounding boxes in the input
argument.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Tuple[int, int, int, int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.serialization.ocr_record">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.serialization.</span></span><span class="sig-name descname"><span class="pre">ocr_record</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">prediction</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cuts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">confidences</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">line</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.serialization.ocr_record" title="Permalink to this definition">¶</a></dt>
<dd><p>A record object containing the recognition result of a single line</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prediction</strong> (<em>str</em>) – </p></li>
<li><p><strong>confidences</strong> (<em>List</em><em>[</em><em>float</em><em>]</em>) – </p></li>
<li><p><strong>line</strong> (<em>Union</em><em>[</em><em>List</em><em>, </em><em>Dict</em><em>[</em><em>str</em><em>, </em><em>List</em><em>]</em><em>]</em>) – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.serialization.render_report">
<span class="sig-prename descclassname"><span class="pre">kraken.serialization.</span></span><span class="sig-name descname"><span class="pre">render_report</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">errors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">char_confusions</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scripts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">insertions</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deletions</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">substitutions</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.serialization.render_report" title="Permalink to this definition">¶</a></dt>
<dd><p>Renders an accuracy report.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> (<em>str</em>) – Model name.</p></li>
<li><p><strong>errors</strong> (<em>int</em>) – Number of errors on test set.</p></li>
<li><p><strong>char_confusions</strong> (<em>dict</em>) – Dictionary mapping a tuple (gt, pred) to a
number of occurrences.</p></li>
<li><p><strong>scripts</strong> (<em>dict</em>) – Dictionary counting character per script.</p></li>
<li><p><strong>insertions</strong> (<em>dict</em>) – Dictionary counting insertion operations per Unicode
script</p></li>
<li><p><strong>deletions</strong> (<em>int</em>) – Number of deletions</p></li>
<li><p><strong>substitutions</strong> (<em>dict</em>) – Dictionary counting substitution operations per
Unicode script.</p></li>
<li><p><strong>chars</strong> (<em>int</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A string containing the rendered report.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.serialization.serialize">
<span class="sig-prename descclassname"><span class="pre">kraken.serialization.</span></span><span class="sig-name descname"><span class="pre">serialize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">records</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0,</span> <span class="pre">0)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">writing_mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'horizontal-tb'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scripts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">template</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'hocr'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.serialization.serialize" title="Permalink to this definition">¶</a></dt>
<dd><p>Serializes a list of ocr_records into an output document.</p>
<p>Serializes a list of predictions and their corresponding positions by doing
some hOCR-specific preprocessing and then renders them through one of
several jinja2 templates.</p>
<p>Note: Empty records are ignored for serialization purposes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>records</strong> (<em>iterable</em>) – List of kraken.rpred.ocr_record</p></li>
<li><p><strong>image_name</strong> (<em>str</em>) – Name of the source image</p></li>
<li><p><strong>image_size</strong> (<em>tuple</em>) – Dimensions of the source image</p></li>
<li><p><strong>writing_mode</strong> (<em>str</em>) – Sets the principal layout of lines and the
direction in which blocks progress. Valid values
are horizontal-tb, vertical-rl, and
vertical-lr.</p></li>
<li><p><strong>scripts</strong> (<em>list</em>) – List of scripts contained in the OCR records</p></li>
<li><p><strong>regions</strong> (<em>list</em>) – Dictionary mapping region types to a list of region
polygons.</p></li>
<li><p><strong>template</strong> (<em>str</em>) – Selector for the serialization format. May be
‘hocr’ or ‘alto’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>(str) rendered template.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-kraken.lib.models">
<span id="kraken-lib-models-module"></span><h2>kraken.lib.models module<a class="headerlink" href="#module-kraken.lib.models" title="Permalink to this headline">¶</a></h2>
<section id="kraken-lib-models">
<h3>kraken.lib.models<a class="headerlink" href="#kraken-lib-models" title="Permalink to this headline">¶</a></h3>
<p>Wrapper around TorchVGSLModel including a variety of forward pass helpers for
sequence classification.</p>
<dl class="py exception">
<dt class="sig sig-object py" id="kraken.lib.models.KrakenInputException">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.models.</span></span><span class="sig-name descname"><span class="pre">KrakenInputException</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.KrakenInputException" title="Permalink to this definition">¶</a></dt>
<dd><p>Common base class for all non-exit exceptions.</p>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="kraken.lib.models.KrakenInvalidModelException">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.models.</span></span><span class="sig-name descname"><span class="pre">KrakenInvalidModelException</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.KrakenInvalidModelException" title="Permalink to this definition">¶</a></dt>
<dd><p>Common base class for all non-exit exceptions.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.models.TorchSeqRecognizer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.models.</span></span><span class="sig-name descname"><span class="pre">TorchSeqRecognizer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decoder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">kraken.lib.ctc_decoder.greedy_decoder</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cpu'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchSeqRecognizer" title="Permalink to this definition">¶</a></dt>
<dd><p>A class wrapping a TorchVGSLModel with a more comfortable recognition interface.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>train</strong> (<em>bool</em>) – </p></li>
<li><p><strong>device</strong> (<em>str</em>) – </p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchSeqRecognizer.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">line</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchSeqRecognizer.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs a forward pass on a torch tensor of one or more lines with
shape (N, C, H, W) and returns a numpy array (N, W, C).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>line</strong> (<em>torch.Tensor</em>) – NCHW line tensor</p></li>
<li><p><strong>lens</strong> (<em>torch.Tensor</em>) – Optional tensor containing sequence lengths if N &gt; 1</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Tuple with (N, W, C) shaped numpy array and final output sequence
lengths.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchSeqRecognizer.predict">
<span class="sig-name descname"><span class="pre">predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">line</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchSeqRecognizer.predict" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs a forward pass on a torch tensor of a line with shape (N, C, H, W)
and returns the decoding as a list of tuples (string, start, end,
confidence).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>line</strong> (<em>torch.Tensor</em>) – NCHW line tensor</p></li>
<li><p><strong>lens</strong> (<em>torch.Tensor</em>) – Optional tensor containing sequence lengths if N &gt; 1</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>List of decoded sequences.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>List[List[Tuple[str, int, int, float]]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchSeqRecognizer.predict_labels">
<span class="sig-name descname"><span class="pre">predict_labels</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">line</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchSeqRecognizer.predict_labels" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs a forward pass on a torch tensor of a line with shape (N, C, H, W)
and returns a list of tuples (class, start, end, max). Max is the
maximum value of the softmax layer in the region.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>line</strong> (<em>torch.tensor</em>) – </p></li>
<li><p><strong>lens</strong> (<em>torch.Tensor</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>List[List[Tuple[int, int, int, float]]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchSeqRecognizer.predict_string">
<span class="sig-name descname"><span class="pre">predict_string</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">line</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchSeqRecognizer.predict_string" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs a forward pass on a torch tensor of a line with shape (N, C, H, W)
and returns a string of the results.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>line</strong> (<em>torch.Tensor</em>) – </p></li>
<li><p><strong>lens</strong> (<em>torch.Tensor</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>List[str]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchSeqRecognizer.to">
<span class="sig-name descname"><span class="pre">to</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchSeqRecognizer.to" title="Permalink to this definition">¶</a></dt>
<dd><p>Moves model to device and automatically loads input tensors onto it.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.models.</span></span><span class="sig-name descname"><span class="pre">TorchVGSLModel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spec</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel" title="Permalink to this definition">¶</a></dt>
<dd><p>Class building a torch module from a VSGL spec.</p>
<p>The initialized class will contain a variable number of layers and a loss
function. Inputs and outputs are always 4D tensors in order (batch,
channels, height, width) with channels always being the feature dimension.</p>
<p>Importantly this means that a recurrent network will be fed the channel
vector at each step along its time axis, i.e. either put the non-time-axis
dimension into the channels dimension or use a summarizing RNN squashing
the time axis to 1 and putting the output into the channels dimension
respectively.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>spec</strong> (<em>str</em>) – </p>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel.input">
<span class="sig-name descname"><span class="pre">input</span></span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel.input" title="Permalink to this definition">¶</a></dt>
<dd><p>Expected input tensor as a 4-tuple.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>tuple</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel.nn">
<span class="sig-name descname"><span class="pre">nn</span></span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel.nn" title="Permalink to this definition">¶</a></dt>
<dd><p>Stack of layers parsed from the spec.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>torch.nn.Sequential</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel.criterion">
<span class="sig-name descname"><span class="pre">criterion</span></span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel.criterion" title="Permalink to this definition">¶</a></dt>
<dd><p>Fully parametrized loss function.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>torch.nn.Module</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel.user_metdata">
<span class="sig-name descname"><span class="pre">user_metdata</span></span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel.user_metdata" title="Permalink to this definition">¶</a></dt>
<dd><p>dict with user defined metadata. Is flushed into
model file during saving/overwritten by loading
operations.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel.one_channel_mode">
<span class="sig-name descname"><span class="pre">one_channel_mode</span></span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel.one_channel_mode" title="Permalink to this definition">¶</a></dt>
<dd><p>Field indicating the image type used during
training of one-channel images. Is ‘1’ for
models trained on binarized images, ‘L’ for
grayscale, and None otherwise.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel.add_codec">
<span class="sig-name descname"><span class="pre">add_codec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">codec</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel.add_codec" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a PytorchCodec to the model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>codec</strong> (<a class="reference internal" href="#kraken.lib.codec.PytorchCodec" title="kraken.lib.codec.PytorchCodec"><em>kraken.lib.codec.PytorchCodec</em></a>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel.append">
<span class="sig-name descname"><span class="pre">append</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">idx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spec</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel.append" title="Permalink to this definition">¶</a></dt>
<dd><p>Splits a model at layer <cite>idx</cite> and append layers <cite>spec</cite>.</p>
<p>New layers are initialized using the init_weights method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>idx</strong> (<em>int</em>) – Index of layer to append spec to starting with 1.  To
select the whole layer stack set idx to None.</p></li>
<li><p><strong>spec</strong> (<em>str</em>) – VGSL spec without input block to append to model.</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel.build_conv">
<span class="sig-name descname"><span class="pre">build_conv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel.build_conv" title="Permalink to this definition">¶</a></dt>
<dd><p>Builds a 2D convolution layer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input</strong> (<em>Tuple</em><em>[</em><em>int</em><em>, </em><em>int</em><em>, </em><em>int</em><em>, </em><em>int</em><em>]</em>) – </p></li>
<li><p><strong>block</strong> (<em>str</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>Union[Tuple[None, None, None], Tuple[Tuple[int, int, int, int], str, Callable]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel.build_dropout">
<span class="sig-name descname"><span class="pre">build_dropout</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel.build_dropout" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input</strong> (<em>Tuple</em><em>[</em><em>int</em><em>, </em><em>int</em><em>, </em><em>int</em><em>, </em><em>int</em><em>]</em>) – </p></li>
<li><p><strong>block</strong> (<em>str</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>Union[Tuple[None, None, None], Tuple[Tuple[int, int, int, int], str, Callable]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel.build_groupnorm">
<span class="sig-name descname"><span class="pre">build_groupnorm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel.build_groupnorm" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input</strong> (<em>Tuple</em><em>[</em><em>int</em><em>, </em><em>int</em><em>, </em><em>int</em><em>, </em><em>int</em><em>]</em>) – </p></li>
<li><p><strong>block</strong> (<em>str</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>Union[Tuple[None, None, None], Tuple[Tuple[int, int, int, int], str, Callable]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel.build_maxpool">
<span class="sig-name descname"><span class="pre">build_maxpool</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel.build_maxpool" title="Permalink to this definition">¶</a></dt>
<dd><p>Builds a maxpool layer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input</strong> (<em>Tuple</em><em>[</em><em>int</em><em>, </em><em>int</em><em>, </em><em>int</em><em>, </em><em>int</em><em>]</em>) – </p></li>
<li><p><strong>block</strong> (<em>str</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>Union[Tuple[None, None, None], Tuple[Tuple[int, int, int, int], str, Callable]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel.build_output">
<span class="sig-name descname"><span class="pre">build_output</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel.build_output" title="Permalink to this definition">¶</a></dt>
<dd><p>Builds an output layer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input</strong> (<em>Tuple</em><em>[</em><em>int</em><em>, </em><em>int</em><em>, </em><em>int</em><em>, </em><em>int</em><em>]</em>) – </p></li>
<li><p><strong>block</strong> (<em>str</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>Union[Tuple[None, None, None], Tuple[Tuple[int, int, int, int], str, Callable]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel.build_reshape">
<span class="sig-name descname"><span class="pre">build_reshape</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel.build_reshape" title="Permalink to this definition">¶</a></dt>
<dd><p>Builds a reshape layer</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input</strong> (<em>Tuple</em><em>[</em><em>int</em><em>, </em><em>int</em><em>, </em><em>int</em><em>, </em><em>int</em><em>]</em>) – </p></li>
<li><p><strong>block</strong> (<em>str</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>Union[Tuple[None, None, None], Tuple[Tuple[int, int, int, int], str, Callable]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel.build_rnn">
<span class="sig-name descname"><span class="pre">build_rnn</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel.build_rnn" title="Permalink to this definition">¶</a></dt>
<dd><p>Builds an LSTM/GRU layer returning number of outputs and layer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input</strong> (<em>Tuple</em><em>[</em><em>int</em><em>, </em><em>int</em><em>, </em><em>int</em><em>, </em><em>int</em><em>]</em>) – </p></li>
<li><p><strong>block</strong> (<em>str</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>Union[Tuple[None, None, None], Tuple[Tuple[int, int, int, int], str, Callable]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel.eval">
<span class="sig-name descname"><span class="pre">eval</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel.eval" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the model to evaluation/inference mode, disabling dropout and
gradient calculation.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel.get_layer_name">
<span class="sig-name descname"><span class="pre">get_layer_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel.get_layer_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a unique identifier for the layer optionally using a supplied
name.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>layer</strong> (<em>str</em>) – Identifier of the layer type</p></li>
<li><p><strong>name</strong> (<em>str</em>) – user-supplied {name} with {} that need removing.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>(str) network unique layer name</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel.hyper_params">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">hyper_params</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel.hyper_params" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel.init_weights">
<span class="sig-name descname"><span class="pre">init_weights</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">idx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">slice(0,</span> <span class="pre">None)</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel.init_weights" title="Permalink to this definition">¶</a></dt>
<dd><p>Initializes weights for all or a subset of layers in the graph.</p>
<p>LSTM/GRU layers are orthogonally initialized, convolutional layers
uniformly from (-0.1,0.1).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>idx</strong> (<em>slice</em>) – A slice object representing the indices of layers to
initialize.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel.load_clstm_model">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">load_clstm_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cls</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel.load_clstm_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads an CLSTM model to VGSL.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>path</strong> (<em>str</em>) – </p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel.load_model">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">load_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cls</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel.load_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Deserializes a VGSL model from a CoreML file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>path</strong> (<em>str</em>) – CoreML file</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A TorchVGSLModel instance.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>KrakenInvalidModelException if the model data is invalid</strong><strong> (</strong><strong>not a</strong> – </p></li>
<li><p><strong>string</strong><strong>, </strong><strong>protobuf file</strong><strong>, or </strong><strong>without appropriate metadata</strong><strong>)</strong><strong></strong> – </p></li>
<li><p><strong>FileNotFoundError if the path doesn't point to a file.</strong> – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel.load_pronn_model">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">load_pronn_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cls</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel.load_pronn_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads an pronn model to VGSL.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>path</strong> (<em>str</em>) – </p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel.model_type">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">model_type</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel.model_type" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="id0">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">one_channel_mode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id0" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel.resize_output">
<span class="sig-name descname"><span class="pre">resize_output</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">del_indices</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel.resize_output" title="Permalink to this definition">¶</a></dt>
<dd><p>Resizes an output layer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output_size</strong> (<em>int</em>) – New size/output channels of last layer</p></li>
<li><p><strong>del_indices</strong> (<em>list</em>) – list of outputs to delete from layer</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel.save_model">
<span class="sig-name descname"><span class="pre">save_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel.save_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Serializes the model into path.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>path</strong> (<em>str</em>) – Target destination</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel.seg_type">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">seg_type</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel.seg_type" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel.set_layer_name">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">set_layer_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">layer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel.set_layer_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the name field of an VGSL layer definition.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>layer</strong> (<em>str</em>) – VGSL definition</p></li>
<li><p><strong>name</strong> (<em>str</em>) – Layer name</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel.set_num_threads">
<span class="sig-name descname"><span class="pre">set_num_threads</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel.set_num_threads" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets number of OpenMP threads to use.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>num</strong> (<em>int</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel.to">
<span class="sig-name descname"><span class="pre">to</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel.to" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>device</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>torch.device</em><em>]</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchVGSLModel.train">
<span class="sig-name descname"><span class="pre">train</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchVGSLModel.train" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the model to training mode (enables dropout layers and disables
softmax on CTC layers).</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.models.load_any">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.models.</span></span><span class="sig-name descname"><span class="pre">load_any</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cpu'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.load_any" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads anything that was, is, and will be a valid ocropus model and
instantiates a shiny new kraken.lib.lstm.SeqRecognizer from the RNN
configuration in the file.</p>
<p>Currently it recognizes the following kinds of models:</p>
<blockquote>
<div><ul class="simple">
<li><p>pyrnn models containing BIDILSTMs</p></li>
<li><p>protobuf models containing converted python BIDILSTMs</p></li>
<li><p>protobuf models containing CLSTM networks</p></li>
</ul>
</div></blockquote>
<p>Additionally an attribute ‘kind’ will be added to the SeqRecognizer
containing a string representation of the source kind. Current known values
are:</p>
<blockquote>
<div><ul class="simple">
<li><p>pyrnn for pickled BIDILSTMs</p></li>
<li><p>clstm for protobuf models generated by clstm</p></li>
</ul>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fname</strong> (<em>str</em>) – Path to the model</p></li>
<li><p><strong>train</strong> (<em>bool</em>) – Enables gradient calculation and dropout layers in model.</p></li>
<li><p><strong>device</strong> (<em>str</em>) – Target device</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A kraken.lib.models.TorchSeqRecognizer object.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#kraken.lib.models.TorchSeqRecognizer" title="kraken.lib.models.TorchSeqRecognizer">TorchSeqRecognizer</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="kraken.lib.models.logger">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.models.</span></span><span class="sig-name descname"><span class="pre">logger</span></span><a class="headerlink" href="#kraken.lib.models.logger" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.models.validate_hyper_parameters">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.models.</span></span><span class="sig-name descname"><span class="pre">validate_hyper_parameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hyper_params</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.validate_hyper_parameters" title="Permalink to this definition">¶</a></dt>
<dd><p>Validate some model’s hyper parameters and modify them in place if need be.</p>
</dd></dl>

</section>
</section>
<section id="module-kraken.lib.vgsl">
<span id="kraken-lib-vgsl-module"></span><h2>kraken.lib.vgsl module<a class="headerlink" href="#module-kraken.lib.vgsl" title="Permalink to this headline">¶</a></h2>
<p>VGSL plumbing</p>
<dl class="py exception">
<dt class="sig sig-object py" id="kraken.lib.vgsl.KrakenInvalidModelException">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.vgsl.</span></span><span class="sig-name descname"><span class="pre">KrakenInvalidModelException</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.KrakenInvalidModelException" title="Permalink to this definition">¶</a></dt>
<dd><p>Common base class for all non-exit exceptions.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.vgsl.PytorchCodec">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.vgsl.</span></span><span class="sig-name descname"><span class="pre">PytorchCodec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">charset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.PytorchCodec" title="Permalink to this definition">¶</a></dt>
<dd><p>Translates between labels and graphemes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>charset</strong> (<em>Union</em><em>[</em><em>Dict</em><em>[</em><em>str</em><em>, </em><em>Sequence</em><em>[</em><em>int</em><em>]</em><em>]</em><em>, </em><em>Sequence</em><em>[</em><em>str</em><em>]</em><em>, </em><em>str</em><em>]</em>) – </p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.PytorchCodec.add_labels">
<span class="sig-name descname"><span class="pre">add_labels</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">charset</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.PytorchCodec.add_labels" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds additional characters/labels to the codec.</p>
<p>charset may either be a string, a list or a dict. In the first case
each code point will be assigned a label, in the second case each
string in the list will be assigned a label, and in the final case each
key string will be mapped to the value sequence of integers. In the
first two cases labels will be assigned automatically.</p>
<p>As 0 is the blank label in a CTC output layer, output labels and input
dictionaries are/should be 1-indexed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>charset</strong> (<em>unicode</em><em>, </em><em>list</em><em>, </em><em>dict</em>) – Input character set.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference internal" href="#kraken.lib.vgsl.PytorchCodec" title="kraken.lib.vgsl.PytorchCodec">PytorchCodec</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.PytorchCodec.decode">
<span class="sig-name descname"><span class="pre">decode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.PytorchCodec.decode" title="Permalink to this definition">¶</a></dt>
<dd><p>Decodes a labelling.</p>
<p>Given a labelling with cuts and  confidences returns a string with the
cuts and confidences aggregated across label-code point
correspondences. When decoding multilabels to code points the resulting
cuts are min/max, confidences are averaged.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>labels</strong> (<em>list</em>) – Input containing tuples (label, start, end,
confidence).</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list of tuples (code point, start, end, confidence)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.PytorchCodec.encode">
<span class="sig-name descname"><span class="pre">encode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">s</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.PytorchCodec.encode" title="Permalink to this definition">¶</a></dt>
<dd><p>Encodes a string into a sequence of labels.</p>
<p>If the code is non-singular we greedily encode the longest sequence first.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>s</strong> (<em>str</em>) – Input unicode string</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>(torch.IntTensor) encoded label sequence</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>torch.IntTensor</p>
</dd>
</dl>
<p>Raises:</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.PytorchCodec.is_valid">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">is_valid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.PytorchCodec.is_valid" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if the codec is prefix-free (in label space) and
non-singular (in both directions).</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.PytorchCodec.max_label">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">max_label</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.PytorchCodec.max_label" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the maximum label value.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.PytorchCodec.merge">
<span class="sig-name descname"><span class="pre">merge</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">codec</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.PytorchCodec.merge" title="Permalink to this definition">¶</a></dt>
<dd><p>Transforms this codec (c1) into another (c2) reusing as many labels as
possible.</p>
<p>The resulting codec is able to encode the same code point sequences
while not necessarily having the same labels for them as c2.
Retains matching character -&gt; label mappings from both codecs, removes
mappings not c2, and adds mappings not in c1. Compound labels in c2 for
code point sequences not in c1 containing labels also in use in c1 are
added as separate labels.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>codec</strong> (<a class="reference internal" href="#kraken.lib.codec.PytorchCodec" title="kraken.lib.codec.PytorchCodec"><em>kraken.lib.codec.PytorchCodec</em></a>) – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A merged codec and a list of labels that were removed from the
original codec.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Tuple[<a class="reference internal" href="#kraken.lib.vgsl.PytorchCodec" title="kraken.lib.vgsl.PytorchCodec">PytorchCodec</a>, Set]</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.vgsl.</span></span><span class="sig-name descname"><span class="pre">TorchVGSLModel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spec</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel" title="Permalink to this definition">¶</a></dt>
<dd><p>Class building a torch module from a VSGL spec.</p>
<p>The initialized class will contain a variable number of layers and a loss
function. Inputs and outputs are always 4D tensors in order (batch,
channels, height, width) with channels always being the feature dimension.</p>
<p>Importantly this means that a recurrent network will be fed the channel
vector at each step along its time axis, i.e. either put the non-time-axis
dimension into the channels dimension or use a summarizing RNN squashing
the time axis to 1 and putting the output into the channels dimension
respectively.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>spec</strong> (<em>str</em>) – </p>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.input">
<span class="sig-name descname"><span class="pre">input</span></span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.input" title="Permalink to this definition">¶</a></dt>
<dd><p>Expected input tensor as a 4-tuple.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>tuple</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.nn">
<span class="sig-name descname"><span class="pre">nn</span></span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.nn" title="Permalink to this definition">¶</a></dt>
<dd><p>Stack of layers parsed from the spec.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>torch.nn.Sequential</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.criterion">
<span class="sig-name descname"><span class="pre">criterion</span></span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.criterion" title="Permalink to this definition">¶</a></dt>
<dd><p>Fully parametrized loss function.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>torch.nn.Module</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.user_metdata">
<span class="sig-name descname"><span class="pre">user_metdata</span></span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.user_metdata" title="Permalink to this definition">¶</a></dt>
<dd><p>dict with user defined metadata. Is flushed into
model file during saving/overwritten by loading
operations.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.one_channel_mode">
<span class="sig-name descname"><span class="pre">one_channel_mode</span></span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.one_channel_mode" title="Permalink to this definition">¶</a></dt>
<dd><p>Field indicating the image type used during
training of one-channel images. Is ‘1’ for
models trained on binarized images, ‘L’ for
grayscale, and None otherwise.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.add_codec">
<span class="sig-name descname"><span class="pre">add_codec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">codec</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.add_codec" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a PytorchCodec to the model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>codec</strong> (<a class="reference internal" href="#kraken.lib.codec.PytorchCodec" title="kraken.lib.codec.PytorchCodec"><em>kraken.lib.codec.PytorchCodec</em></a>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.append">
<span class="sig-name descname"><span class="pre">append</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">idx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spec</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.append" title="Permalink to this definition">¶</a></dt>
<dd><p>Splits a model at layer <cite>idx</cite> and append layers <cite>spec</cite>.</p>
<p>New layers are initialized using the init_weights method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>idx</strong> (<em>int</em>) – Index of layer to append spec to starting with 1.  To
select the whole layer stack set idx to None.</p></li>
<li><p><strong>spec</strong> (<em>str</em>) – VGSL spec without input block to append to model.</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.build_conv">
<span class="sig-name descname"><span class="pre">build_conv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.build_conv" title="Permalink to this definition">¶</a></dt>
<dd><p>Builds a 2D convolution layer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input</strong> (<em>Tuple</em><em>[</em><em>int</em><em>, </em><em>int</em><em>, </em><em>int</em><em>, </em><em>int</em><em>]</em>) – </p></li>
<li><p><strong>block</strong> (<em>str</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>Union[Tuple[None, None, None], Tuple[Tuple[int, int, int, int], str, Callable]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.build_dropout">
<span class="sig-name descname"><span class="pre">build_dropout</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.build_dropout" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input</strong> (<em>Tuple</em><em>[</em><em>int</em><em>, </em><em>int</em><em>, </em><em>int</em><em>, </em><em>int</em><em>]</em>) – </p></li>
<li><p><strong>block</strong> (<em>str</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>Union[Tuple[None, None, None], Tuple[Tuple[int, int, int, int], str, Callable]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.build_groupnorm">
<span class="sig-name descname"><span class="pre">build_groupnorm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.build_groupnorm" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input</strong> (<em>Tuple</em><em>[</em><em>int</em><em>, </em><em>int</em><em>, </em><em>int</em><em>, </em><em>int</em><em>]</em>) – </p></li>
<li><p><strong>block</strong> (<em>str</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>Union[Tuple[None, None, None], Tuple[Tuple[int, int, int, int], str, Callable]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.build_maxpool">
<span class="sig-name descname"><span class="pre">build_maxpool</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.build_maxpool" title="Permalink to this definition">¶</a></dt>
<dd><p>Builds a maxpool layer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input</strong> (<em>Tuple</em><em>[</em><em>int</em><em>, </em><em>int</em><em>, </em><em>int</em><em>, </em><em>int</em><em>]</em>) – </p></li>
<li><p><strong>block</strong> (<em>str</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>Union[Tuple[None, None, None], Tuple[Tuple[int, int, int, int], str, Callable]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.build_output">
<span class="sig-name descname"><span class="pre">build_output</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.build_output" title="Permalink to this definition">¶</a></dt>
<dd><p>Builds an output layer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input</strong> (<em>Tuple</em><em>[</em><em>int</em><em>, </em><em>int</em><em>, </em><em>int</em><em>, </em><em>int</em><em>]</em>) – </p></li>
<li><p><strong>block</strong> (<em>str</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>Union[Tuple[None, None, None], Tuple[Tuple[int, int, int, int], str, Callable]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.build_reshape">
<span class="sig-name descname"><span class="pre">build_reshape</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.build_reshape" title="Permalink to this definition">¶</a></dt>
<dd><p>Builds a reshape layer</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input</strong> (<em>Tuple</em><em>[</em><em>int</em><em>, </em><em>int</em><em>, </em><em>int</em><em>, </em><em>int</em><em>]</em>) – </p></li>
<li><p><strong>block</strong> (<em>str</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>Union[Tuple[None, None, None], Tuple[Tuple[int, int, int, int], str, Callable]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.build_rnn">
<span class="sig-name descname"><span class="pre">build_rnn</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.build_rnn" title="Permalink to this definition">¶</a></dt>
<dd><p>Builds an LSTM/GRU layer returning number of outputs and layer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input</strong> (<em>Tuple</em><em>[</em><em>int</em><em>, </em><em>int</em><em>, </em><em>int</em><em>, </em><em>int</em><em>]</em>) – </p></li>
<li><p><strong>block</strong> (<em>str</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>Union[Tuple[None, None, None], Tuple[Tuple[int, int, int, int], str, Callable]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.eval">
<span class="sig-name descname"><span class="pre">eval</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.eval" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the model to evaluation/inference mode, disabling dropout and
gradient calculation.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.get_layer_name">
<span class="sig-name descname"><span class="pre">get_layer_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.get_layer_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a unique identifier for the layer optionally using a supplied
name.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>layer</strong> (<em>str</em>) – Identifier of the layer type</p></li>
<li><p><strong>name</strong> (<em>str</em>) – user-supplied {name} with {} that need removing.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>(str) network unique layer name</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.hyper_params">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">hyper_params</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.hyper_params" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.init_weights">
<span class="sig-name descname"><span class="pre">init_weights</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">idx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">slice(0,</span> <span class="pre">None)</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.init_weights" title="Permalink to this definition">¶</a></dt>
<dd><p>Initializes weights for all or a subset of layers in the graph.</p>
<p>LSTM/GRU layers are orthogonally initialized, convolutional layers
uniformly from (-0.1,0.1).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>idx</strong> (<em>slice</em>) – A slice object representing the indices of layers to
initialize.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.load_clstm_model">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">load_clstm_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cls</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.load_clstm_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads an CLSTM model to VGSL.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>path</strong> (<em>str</em>) – </p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.load_model">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">load_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cls</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.load_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Deserializes a VGSL model from a CoreML file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>path</strong> (<em>str</em>) – CoreML file</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A TorchVGSLModel instance.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>KrakenInvalidModelException if the model data is invalid</strong><strong> (</strong><strong>not a</strong> – </p></li>
<li><p><strong>string</strong><strong>, </strong><strong>protobuf file</strong><strong>, or </strong><strong>without appropriate metadata</strong><strong>)</strong><strong></strong> – </p></li>
<li><p><strong>FileNotFoundError if the path doesn't point to a file.</strong> – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.load_pronn_model">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">load_pronn_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cls</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.load_pronn_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads an pronn model to VGSL.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>path</strong> (<em>str</em>) – </p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.model_type">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">model_type</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.model_type" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="id1">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">one_channel_mode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id1" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.resize_output">
<span class="sig-name descname"><span class="pre">resize_output</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">del_indices</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.resize_output" title="Permalink to this definition">¶</a></dt>
<dd><p>Resizes an output layer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output_size</strong> (<em>int</em>) – New size/output channels of last layer</p></li>
<li><p><strong>del_indices</strong> (<em>list</em>) – list of outputs to delete from layer</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.save_model">
<span class="sig-name descname"><span class="pre">save_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.save_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Serializes the model into path.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>path</strong> (<em>str</em>) – Target destination</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.seg_type">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">seg_type</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.seg_type" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.set_layer_name">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">set_layer_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">layer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.set_layer_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the name field of an VGSL layer definition.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>layer</strong> (<em>str</em>) – VGSL definition</p></li>
<li><p><strong>name</strong> (<em>str</em>) – Layer name</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.set_num_threads">
<span class="sig-name descname"><span class="pre">set_num_threads</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.set_num_threads" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets number of OpenMP threads to use.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>num</strong> (<em>int</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.to">
<span class="sig-name descname"><span class="pre">to</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.to" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>device</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>torch.device</em><em>]</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.train">
<span class="sig-name descname"><span class="pre">train</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.train" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the model to training mode (enables dropout layers and disables
softmax on CTC layers).</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="kraken.lib.vgsl.logger">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.vgsl.</span></span><span class="sig-name descname"><span class="pre">logger</span></span><a class="headerlink" href="#kraken.lib.vgsl.logger" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="module-kraken.lib.xml">
<span id="kraken-lib-xml-module"></span><h2>kraken.lib.xml module<a class="headerlink" href="#module-kraken.lib.xml" title="Permalink to this headline">¶</a></h2>
<p>ALTO/Page data loaders for segmentation training</p>
<dl class="py exception">
<dt class="sig sig-object py" id="kraken.lib.xml.KrakenInputException">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.xml.</span></span><span class="sig-name descname"><span class="pre">KrakenInputException</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.xml.KrakenInputException" title="Permalink to this definition">¶</a></dt>
<dd><p>Common base class for all non-exit exceptions.</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="kraken.lib.xml.alto_regions">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.xml.</span></span><span class="sig-name descname"><span class="pre">alto_regions</span></span><a class="headerlink" href="#kraken.lib.xml.alto_regions" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="kraken.lib.xml.logger">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.xml.</span></span><span class="sig-name descname"><span class="pre">logger</span></span><a class="headerlink" href="#kraken.lib.xml.logger" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="kraken.lib.xml.page_regions">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.xml.</span></span><span class="sig-name descname"><span class="pre">page_regions</span></span><a class="headerlink" href="#kraken.lib.xml.page_regions" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.xml.parse_alto">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.xml.</span></span><span class="sig-name descname"><span class="pre">parse_alto</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.xml.parse_alto" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses an ALTO file, returns the baselines defined in it, and loads the
referenced image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>filename</strong> (<em>str</em>) – path to an ALTO file.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>impath, lines: [{‘boundary’: [[x0, y0], …],
‘baseline’: [[x0, y0], …]}, {…], ‘text’: ‘apdjfqpf’, ‘script’:
‘script_type’}, regions: {‘region_type_0’: [[[x0, y0], …], …],
…}, ‘base_dir’: None}</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>A dict {‘image’</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.xml.parse_page">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.xml.</span></span><span class="sig-name descname"><span class="pre">parse_page</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.xml.parse_page" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses a PageXML file, returns the baselines defined in it, and loads the
referenced image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>filename</strong> (<em>str</em>) – path to a PageXML file.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>impath, lines: [{‘boundary’: [[x0, y0], …],
‘baseline’: [[x0, y0], …]}, {…], ‘text’: ‘apdjfqpf’, ‘script’:
‘script_type’}, regions: {‘region_type_0’: [[[x0, y0], …], …],
…}}</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>A dict {‘image’</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.xml.parse_xml">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.xml.</span></span><span class="sig-name descname"><span class="pre">parse_xml</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.xml.parse_xml" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses either a PageXML or ALTO file with autodetermination of the file
format.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>filename</strong> (<em>str</em>) – path to an XML file.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>impath, lines: [{‘boundary’: [[x0, y0], …],
‘baseline’: [[x0, y0], …]}, {…], ‘text’: ‘apdjfqpf’, ‘script’:
‘script_type’}, regions: {‘region_type_0’: [[[x0, y0], …], …],
…}, ‘base_dir’: None}</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>A dict {‘image’</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-kraken.lib.codec">
<span id="kraken-lib-codec"></span><h2>kraken.lib.codec<a class="headerlink" href="#module-kraken.lib.codec" title="Permalink to this headline">¶</a></h2>
<p>pytorch compatible codec with many-to-many mapping between labels and
graphemes.</p>
<dl class="py exception">
<dt class="sig sig-object py" id="kraken.lib.codec.KrakenCodecException">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.codec.</span></span><span class="sig-name descname"><span class="pre">KrakenCodecException</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.codec.KrakenCodecException" title="Permalink to this definition">¶</a></dt>
<dd><p>Common base class for all non-exit exceptions.</p>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="kraken.lib.codec.KrakenEncodeException">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.codec.</span></span><span class="sig-name descname"><span class="pre">KrakenEncodeException</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.codec.KrakenEncodeException" title="Permalink to this definition">¶</a></dt>
<dd><p>Common base class for all non-exit exceptions.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.codec.PytorchCodec">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.codec.</span></span><span class="sig-name descname"><span class="pre">PytorchCodec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">charset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.codec.PytorchCodec" title="Permalink to this definition">¶</a></dt>
<dd><p>Translates between labels and graphemes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>charset</strong> (<em>Union</em><em>[</em><em>Dict</em><em>[</em><em>str</em><em>, </em><em>Sequence</em><em>[</em><em>int</em><em>]</em><em>]</em><em>, </em><em>Sequence</em><em>[</em><em>str</em><em>]</em><em>, </em><em>str</em><em>]</em>) – </p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.codec.PytorchCodec.add_labels">
<span class="sig-name descname"><span class="pre">add_labels</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">charset</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.codec.PytorchCodec.add_labels" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds additional characters/labels to the codec.</p>
<p>charset may either be a string, a list or a dict. In the first case
each code point will be assigned a label, in the second case each
string in the list will be assigned a label, and in the final case each
key string will be mapped to the value sequence of integers. In the
first two cases labels will be assigned automatically.</p>
<p>As 0 is the blank label in a CTC output layer, output labels and input
dictionaries are/should be 1-indexed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>charset</strong> (<em>unicode</em><em>, </em><em>list</em><em>, </em><em>dict</em>) – Input character set.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference internal" href="#kraken.lib.codec.PytorchCodec" title="kraken.lib.codec.PytorchCodec">PytorchCodec</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.codec.PytorchCodec.decode">
<span class="sig-name descname"><span class="pre">decode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.codec.PytorchCodec.decode" title="Permalink to this definition">¶</a></dt>
<dd><p>Decodes a labelling.</p>
<p>Given a labelling with cuts and  confidences returns a string with the
cuts and confidences aggregated across label-code point
correspondences. When decoding multilabels to code points the resulting
cuts are min/max, confidences are averaged.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>labels</strong> (<em>list</em>) – Input containing tuples (label, start, end,
confidence).</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list of tuples (code point, start, end, confidence)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.codec.PytorchCodec.encode">
<span class="sig-name descname"><span class="pre">encode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">s</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.codec.PytorchCodec.encode" title="Permalink to this definition">¶</a></dt>
<dd><p>Encodes a string into a sequence of labels.</p>
<p>If the code is non-singular we greedily encode the longest sequence first.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>s</strong> (<em>str</em>) – Input unicode string</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>(torch.IntTensor) encoded label sequence</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>torch.IntTensor</p>
</dd>
</dl>
<p>Raises:</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.codec.PytorchCodec.is_valid">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">is_valid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.codec.PytorchCodec.is_valid" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if the codec is prefix-free (in label space) and
non-singular (in both directions).</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.codec.PytorchCodec.max_label">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">max_label</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.codec.PytorchCodec.max_label" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the maximum label value.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.codec.PytorchCodec.merge">
<span class="sig-name descname"><span class="pre">merge</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">codec</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.codec.PytorchCodec.merge" title="Permalink to this definition">¶</a></dt>
<dd><p>Transforms this codec (c1) into another (c2) reusing as many labels as
possible.</p>
<p>The resulting codec is able to encode the same code point sequences
while not necessarily having the same labels for them as c2.
Retains matching character -&gt; label mappings from both codecs, removes
mappings not c2, and adds mappings not in c1. Compound labels in c2 for
code point sequences not in c1 containing labels also in use in c1 are
added as separate labels.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>codec</strong> (<a class="reference internal" href="#kraken.lib.codec.PytorchCodec" title="kraken.lib.codec.PytorchCodec"><em>kraken.lib.codec.PytorchCodec</em></a>) – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A merged codec and a list of labels that were removed from the
original codec.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Tuple[<a class="reference internal" href="#kraken.lib.codec.PytorchCodec" title="kraken.lib.codec.PytorchCodec">PytorchCodec</a>, Set]</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="kraken.lib.codec.logger">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.codec.</span></span><span class="sig-name descname"><span class="pre">logger</span></span><a class="headerlink" href="#kraken.lib.codec.logger" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="module-kraken.lib.train">
<span id="kraken-lib-train-module"></span><h2>kraken.lib.train module<a class="headerlink" href="#module-kraken.lib.train" title="Permalink to this headline">¶</a></h2>
<p>Training loop interception helpers</p>
<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.train.BaselineSet">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">BaselineSet</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">imgs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">suffix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'.path'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">line_width</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">im_transforms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">transforms.Compose([])</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'path'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">augmentation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">valid_baselines</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">merge_baselines</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">valid_regions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">merge_regions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.BaselineSet" title="Permalink to this definition">¶</a></dt>
<dd><p>Dataset for training a baseline/region segmentation model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>imgs</strong> (<em>Sequence</em><em>[</em><em>str</em><em>]</em>) – </p></li>
<li><p><strong>suffix</strong> (<em>str</em>) – </p></li>
<li><p><strong>line_width</strong> (<em>int</em>) – </p></li>
<li><p><strong>im_transforms</strong> (<em>Callable</em><em>[</em><em>[</em><em>Any</em><em>]</em><em>, </em><em>torch.Tensor</em><em>]</em>) – </p></li>
<li><p><strong>mode</strong> (<em>str</em>) – </p></li>
<li><p><strong>augmentation</strong> (<em>bool</em>) – </p></li>
<li><p><strong>valid_baselines</strong> (<em>Sequence</em><em>[</em><em>str</em><em>]</em>) – </p></li>
<li><p><strong>merge_baselines</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>Sequence</em><em>[</em><em>str</em><em>]</em><em>]</em>) – </p></li>
<li><p><strong>valid_regions</strong> (<em>Sequence</em><em>[</em><em>str</em><em>]</em>) – </p></li>
<li><p><strong>merge_regions</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>Sequence</em><em>[</em><em>str</em><em>]</em><em>]</em>) – </p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.BaselineSet.add">
<span class="sig-name descname"><span class="pre">add</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">baselines</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.BaselineSet.add" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a page to the dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>path</em>) – Path to the whole page image</p></li>
<li><p><strong>baseline</strong> (<em>dict</em>) – A list containing dicts with a list of coordinates
and script types [{‘baseline’: [[x0, y0], …,
[xn, yn]], ‘script’: ‘script_type’}, …]</p></li>
<li><p><strong>regions</strong> (<em>dict</em>) – A dict containing list of lists of coordinates
{‘region_type_0’: [[x0, y0], …, [xn, yn]]],
‘region_type_1’: …}.</p></li>
<li><p><strong>image</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>PIL.Image.Image</em><em>]</em>) – </p></li>
<li><p><strong>baselines</strong> (<em>List</em><em>[</em><em>List</em><em>[</em><em>List</em><em>[</em><em>Tuple</em><em>[</em><em>int</em><em>, </em><em>int</em><em>]</em><em>]</em><em>]</em><em>]</em>) – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.BaselineSet.transform">
<span class="sig-name descname"><span class="pre">transform</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.BaselineSet.transform" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.train.EarlyStopping">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">EarlyStopping</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">min_delta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lag</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.EarlyStopping" title="Permalink to this definition">¶</a></dt>
<dd><p>Early stopping to terminate training when validation loss doesn’t improve
over a certain time.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>min_delta</strong> (<em>float</em>) – </p></li>
<li><p><strong>lag</strong> (<em>int</em>) – </p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.EarlyStopping.trigger">
<span class="sig-name descname"><span class="pre">trigger</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.EarlyStopping.trigger" title="Permalink to this definition">¶</a></dt>
<dd><p>Function that raises a KrakenStopTrainingException after if the abort
condition is fulfilled.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.EarlyStopping.update">
<span class="sig-name descname"><span class="pre">update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_loss</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.EarlyStopping.update" title="Permalink to this definition">¶</a></dt>
<dd><p>Updates the internal validation loss state and increases counter by
one.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>val_loss</strong> (<em>torch.float</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.train.EpochStopping">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">EpochStopping</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">epochs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.EpochStopping" title="Permalink to this definition">¶</a></dt>
<dd><p>Dumb stopping after a fixed number of iterations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>epochs</strong> (<em>int</em>) – </p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.EpochStopping.trigger">
<span class="sig-name descname"><span class="pre">trigger</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.EpochStopping.trigger" title="Permalink to this definition">¶</a></dt>
<dd><p>Function that raises a KrakenStopTrainingException after if the abort
condition is fulfilled.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.EpochStopping.update">
<span class="sig-name descname"><span class="pre">update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_loss</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.EpochStopping.update" title="Permalink to this definition">¶</a></dt>
<dd><p>Only update internal best iteration</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>val_loss</strong> (<em>torch.float</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.train.GroundTruthDataset">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">GroundTruthDataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">split</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">F_t.default_split</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">suffix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'.gt.txt'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">whitespace_normalization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reorder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">im_transforms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">transforms.Compose([])</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">preload</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">augmentation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.GroundTruthDataset" title="Permalink to this definition">¶</a></dt>
<dd><p>Dataset for training a line recognition model.</p>
<p>All data is cached in memory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>split</strong> (<em>Callable</em><em>[</em><em>[</em><em>str</em><em>]</em><em>, </em><em>str</em><em>]</em>) – </p></li>
<li><p><strong>suffix</strong> (<em>str</em>) – </p></li>
<li><p><strong>normalization</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em>) – </p></li>
<li><p><strong>whitespace_normalization</strong> (<em>bool</em>) – </p></li>
<li><p><strong>reorder</strong> (<em>Union</em><em>[</em><em>bool</em><em>, </em><em>str</em><em>]</em>) – </p></li>
<li><p><strong>im_transforms</strong> (<em>Callable</em><em>[</em><em>[</em><em>Any</em><em>]</em><em>, </em><em>torch.Tensor</em><em>]</em>) – </p></li>
<li><p><strong>preload</strong> (<em>bool</em>) – </p></li>
<li><p><strong>augmentation</strong> (<em>bool</em>) – </p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.GroundTruthDataset.add">
<span class="sig-name descname"><span class="pre">add</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.GroundTruthDataset.add" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a line-image-text pair to the dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>image</strong> (<em>str</em>) – Input image path</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.GroundTruthDataset.add_loaded">
<span class="sig-name descname"><span class="pre">add_loaded</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gt</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.GroundTruthDataset.add_loaded" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds an already loaded line-image-text pair to the dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<em>PIL.Image.Image</em>) – Line image</p></li>
<li><p><strong>gt</strong> (<em>str</em>) – Text contained in the line image</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.GroundTruthDataset.encode">
<span class="sig-name descname"><span class="pre">encode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">codec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.GroundTruthDataset.encode" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a codec to the dataset and encodes all text lines.</p>
<p>Has to be run before sampling from the dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>codec</strong> (<em>Optional</em><em>[</em><a class="reference internal" href="#kraken.lib.codec.PytorchCodec" title="kraken.lib.codec.PytorchCodec"><em>kraken.lib.codec.PytorchCodec</em></a><em>]</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.GroundTruthDataset.no_encode">
<span class="sig-name descname"><span class="pre">no_encode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.GroundTruthDataset.no_encode" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates an unencoded dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.GroundTruthDataset.parse">
<span class="sig-name descname"><span class="pre">parse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.GroundTruthDataset.parse" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses a sample for this dataset.</p>
<p>This is mostly used to parallelize populating the dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>image</strong> (<em>str</em>) – Input image path</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>Dict</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.train.InfiniteDataLoader">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">InfiniteDataLoader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.InfiniteDataLoader" title="Permalink to this definition">¶</a></dt>
<dd><p>Version of DataLoader that auto-reinitializes the iterator once it is
exhausted.</p>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="kraken.lib.train.KrakenEncodeException">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">KrakenEncodeException</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.KrakenEncodeException" title="Permalink to this definition">¶</a></dt>
<dd><p>Common base class for all non-exit exceptions.</p>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="kraken.lib.train.KrakenInputException">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">KrakenInputException</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.KrakenInputException" title="Permalink to this definition">¶</a></dt>
<dd><p>Common base class for all non-exit exceptions.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.train.KrakenTrainer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">KrakenTrainer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimizer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cpu'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename_prefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'model'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">event_frequency</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_set</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_set</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stopper</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss_fn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">recognition_loss_fn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">evaluator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">recognition_evaluator_fn</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.KrakenTrainer" title="Permalink to this definition">¶</a></dt>
<dd><p>Class encapsulating the recognition model training process.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> (<a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel" title="kraken.lib.vgsl.TorchVGSLModel"><em>kraken.lib.vgsl.TorchVGSLModel</em></a>) – </p></li>
<li><p><strong>optimizer</strong> (<em>torch.optim.Optimizer</em>) – </p></li>
<li><p><strong>device</strong> (<em>str</em>) – </p></li>
<li><p><strong>filename_prefix</strong> (<em>str</em>) – </p></li>
<li><p><strong>event_frequency</strong> (<em>float</em>) – </p></li>
<li><p><strong>train_set</strong> (<em>torch.utils.data.DataLoader</em>) – </p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.KrakenTrainer.add_lr_scheduler">
<span class="sig-name descname"><span class="pre">add_lr_scheduler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lr_scheduler</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.KrakenTrainer.add_lr_scheduler" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>lr_scheduler</strong> (<a class="reference internal" href="#kraken.lib.train.TrainScheduler" title="kraken.lib.train.TrainScheduler"><em>TrainScheduler</em></a>) – </p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.KrakenTrainer.load_model">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">load_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cls</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load_hyper_parameters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">message</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">lambda</span> <span class="pre">*args,</span> <span class="pre">**kwargs:</span> <span class="pre">...</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.KrakenTrainer.load_model" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model_path</strong> (<em>str</em>) – </p></li>
<li><p><strong>load_hyper_parameters</strong> (<em>Optional</em><em>[</em><em>bool</em><em>]</em>) – </p></li>
<li><p><strong>message</strong> (<em>Callable</em><em>[</em><em>[</em><em>str</em><em>]</em><em>, </em><em>None</em><em>]</em>) – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.KrakenTrainer.recognition_train_gen">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">recognition_train_gen</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cls</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hyper_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">progress_callback</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">lambda</span> <span class="pre">string,</span> <span class="pre">length:</span> <span class="pre">...</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">message</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">lambda</span> <span class="pre">*args,</span> <span class="pre">**kwargs:</span> <span class="pre">...</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'model'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">default_specs.RECOGNITION_SPEC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">append</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cpu'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reorder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">training_data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">evaluation_data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">preload</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threads</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load_hyper_parameters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">repolygonize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_binarization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">format_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'path'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">codec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'fail'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">augment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.KrakenTrainer.recognition_train_gen" title="Permalink to this definition">¶</a></dt>
<dd><p>This is an ugly constructor that takes all the arguments from the command
line driver, finagles the datasets, models, and hyperparameters correctly
and returns a KrakenTrainer object.</p>
<p>Setup parameters (load, training_data, evaluation_data, ….) are named,
model hyperparameters (everything in
kraken.lib.default_specs.RECOGNITION_HYPER_PARAMS) are in in the
<cite>hyper_params</cite> argument.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hyper_params</strong> (<em>dict</em>) – Hyperparameter dictionary containing all fields
from
kraken.lib.default_specs.RECOGNITION_HYPER_PARAMS</p></li>
<li><p><strong>progress_callback</strong> (<em>Callable</em>) – Callback for progress reports on various
computationally expensive processes. A
human readable string and the process
length is supplied. The callback has to
return another function which will be
executed after each step.</p></li>
<li><p><strong>message</strong> (<em>Callable</em>) – Messaging printing method for above log but below
warning level output, i.e. infos that should
generally be shown to users.</p></li>
<li><p><strong>**kwargs</strong> – Setup parameters, i.e. CLI parameters of the train() command.</p></li>
<li><p><strong>output</strong> (<em>str</em>) – </p></li>
<li><p><strong>spec</strong> (<em>str</em>) – </p></li>
<li><p><strong>append</strong> (<em>Optional</em><em>[</em><em>int</em><em>]</em>) – </p></li>
<li><p><strong>load</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em>) – </p></li>
<li><p><strong>device</strong> (<em>str</em>) – </p></li>
<li><p><strong>reorder</strong> (<em>Union</em><em>[</em><em>bool</em><em>, </em><em>str</em><em>]</em>) – </p></li>
<li><p><strong>training_data</strong> (<em>Sequence</em><em>[</em><em>Dict</em><em>]</em>) – </p></li>
<li><p><strong>evaluation_data</strong> (<em>Sequence</em><em>[</em><em>Dict</em><em>]</em>) – </p></li>
<li><p><strong>preload</strong> (<em>Optional</em><em>[</em><em>bool</em><em>]</em>) – </p></li>
<li><p><strong>threads</strong> (<em>int</em>) – </p></li>
<li><p><strong>load_hyper_parameters</strong> (<em>bool</em>) – </p></li>
<li><p><strong>repolygonize</strong> (<em>bool</em>) – </p></li>
<li><p><strong>force_binarization</strong> (<em>bool</em>) – </p></li>
<li><p><strong>format_type</strong> (<em>str</em>) – </p></li>
<li><p><strong>codec</strong> (<em>Optional</em><em>[</em><em>Dict</em><em>]</em>) – </p></li>
<li><p><strong>resize</strong> (<em>str</em>) – </p></li>
<li><p><strong>augment</strong> (<em>bool</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A KrakenTrainer object.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.KrakenTrainer.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">event_callback</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">lambda</span> <span class="pre">*args,</span> <span class="pre">**kwargs:</span> <span class="pre">...</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iteration_callback</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">lambda</span> <span class="pre">*args,</span> <span class="pre">**kwargs:</span> <span class="pre">...</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.KrakenTrainer.run" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.KrakenTrainer.segmentation_train_gen">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">segmentation_train_gen</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cls</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hyper_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load_hyper_parameters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">progress_callback</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">lambda</span> <span class="pre">string,</span> <span class="pre">length:</span> <span class="pre">...</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">message</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">lambda</span> <span class="pre">*args,</span> <span class="pre">**kwargs:</span> <span class="pre">...</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'model'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">default_specs.SEGMENTATION_SPEC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cpu'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">training_data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">evaluation_data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threads</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_binarization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">format_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'path'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">suppress_regions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">suppress_baselines</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">valid_regions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">valid_baselines</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">merge_regions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">merge_baselines</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bounding_regions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'fail'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">augment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">topline</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.KrakenTrainer.segmentation_train_gen" title="Permalink to this definition">¶</a></dt>
<dd><p>This is an ugly constructor that takes all the arguments from the command
line driver, finagles the datasets, models, and hyperparameters correctly
and returns a KrakenTrainer object.</p>
<p>Setup parameters (load, training_data, evaluation_data, ….) are named,
model hyperparameters (everything in
kraken.lib.default_specs.SEGMENTATION_HYPER_PARAMS) are in in the
<cite>hyper_params</cite> argument.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hyper_params</strong> (<em>dict</em>) – Hyperparameter dictionary containing all fields
from
kraken.lib.default_specs.SEGMENTATION_HYPER_PARAMS</p></li>
<li><p><strong>progress_callback</strong> (<em>Callable</em>) – Callback for progress reports on various
computationally expensive processes. A
human readable string and the process
length is supplied. The callback has to
return another function which will be
executed after each step.</p></li>
<li><p><strong>message</strong> (<em>Callable</em>) – Messaging printing method for above log but below
warning level output, i.e. infos that should
generally be shown to users.</p></li>
<li><p><strong>**kwargs</strong> – Setup parameters, i.e. CLI parameters of the train() command.</p></li>
<li><p><strong>load_hyper_parameters</strong> (<em>bool</em>) – </p></li>
<li><p><strong>output</strong> (<em>str</em>) – </p></li>
<li><p><strong>spec</strong> (<em>str</em>) – </p></li>
<li><p><strong>load</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em>) – </p></li>
<li><p><strong>device</strong> (<em>str</em>) – </p></li>
<li><p><strong>training_data</strong> (<em>Sequence</em><em>[</em><em>Dict</em><em>]</em>) – </p></li>
<li><p><strong>evaluation_data</strong> (<em>Sequence</em><em>[</em><em>Dict</em><em>]</em>) – </p></li>
<li><p><strong>threads</strong> (<em>int</em>) – </p></li>
<li><p><strong>force_binarization</strong> (<em>bool</em>) – </p></li>
<li><p><strong>format_type</strong> (<em>str</em>) – </p></li>
<li><p><strong>suppress_regions</strong> (<em>bool</em>) – </p></li>
<li><p><strong>suppress_baselines</strong> (<em>bool</em>) – </p></li>
<li><p><strong>valid_regions</strong> (<em>Optional</em><em>[</em><em>Sequence</em><em>[</em><em>str</em><em>]</em><em>]</em>) – </p></li>
<li><p><strong>valid_baselines</strong> (<em>Optional</em><em>[</em><em>Sequence</em><em>[</em><em>str</em><em>]</em><em>]</em>) – </p></li>
<li><p><strong>merge_regions</strong> (<em>Optional</em><em>[</em><em>Dict</em><em>[</em><em>str</em><em>, </em><em>str</em><em>]</em><em>]</em>) – </p></li>
<li><p><strong>merge_baselines</strong> (<em>Optional</em><em>[</em><em>Dict</em><em>[</em><em>str</em><em>, </em><em>str</em><em>]</em><em>]</em>) – </p></li>
<li><p><strong>bounding_regions</strong> (<em>Optional</em><em>[</em><em>Sequence</em><em>[</em><em>str</em><em>]</em><em>]</em>) – </p></li>
<li><p><strong>resize</strong> (<em>str</em>) – </p></li>
<li><p><strong>augment</strong> (<em>bool</em>) – </p></li>
<li><p><strong>topline</strong> (<em>Union</em><em>[</em><em>bool</em><em>, </em><em>None</em><em>]</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A KrakenTrainer object.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.train.NoStopping">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">NoStopping</span></span><a class="headerlink" href="#kraken.lib.train.NoStopping" title="Permalink to this definition">¶</a></dt>
<dd><p>Never stops training.</p>
<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.NoStopping.trigger">
<span class="sig-name descname"><span class="pre">trigger</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.NoStopping.trigger" title="Permalink to this definition">¶</a></dt>
<dd><p>Function that raises a KrakenStopTrainingException after if the abort
condition is fulfilled.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.NoStopping.update">
<span class="sig-name descname"><span class="pre">update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_loss</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.NoStopping.update" title="Permalink to this definition">¶</a></dt>
<dd><p>Only update internal best iteration</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>val_loss</strong> (<em>torch.float</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.train.PolygonGTDataset">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">PolygonGTDataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">normalization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">whitespace_normalization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reorder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">im_transforms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">transforms.Compose([])</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">preload</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">augmentation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.PolygonGTDataset" title="Permalink to this definition">¶</a></dt>
<dd><p>Dataset for training a line recognition model from polygonal/baseline data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>normalization</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em>) – </p></li>
<li><p><strong>whitespace_normalization</strong> (<em>bool</em>) – </p></li>
<li><p><strong>reorder</strong> (<em>Union</em><em>[</em><em>bool</em><em>, </em><em>str</em><em>]</em>) – </p></li>
<li><p><strong>im_transforms</strong> (<em>Callable</em><em>[</em><em>[</em><em>Any</em><em>]</em><em>, </em><em>torch.Tensor</em><em>]</em>) – </p></li>
<li><p><strong>preload</strong> (<em>bool</em>) – </p></li>
<li><p><strong>augmentation</strong> (<em>bool</em>) – </p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.PolygonGTDataset.add">
<span class="sig-name descname"><span class="pre">add</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.PolygonGTDataset.add" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a line to the dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>path</em>) – Path to the whole page image</p></li>
<li><p><strong>text</strong> (<em>str</em>) – Transcription of the line.</p></li>
<li><p><strong>baseline</strong> (<em>list</em>) – A list of coordinates [[x0, y0], …, [xn, yn]].</p></li>
<li><p><strong>boundary</strong> (<em>list</em>) – A polygon mask for the line.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.PolygonGTDataset.encode">
<span class="sig-name descname"><span class="pre">encode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">codec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.PolygonGTDataset.encode" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a codec to the dataset and encodes all text lines.</p>
<p>Has to be run before sampling from the dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>codec</strong> (<em>Optional</em><em>[</em><a class="reference internal" href="#kraken.lib.codec.PytorchCodec" title="kraken.lib.codec.PytorchCodec"><em>kraken.lib.codec.PytorchCodec</em></a><em>]</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.PolygonGTDataset.no_encode">
<span class="sig-name descname"><span class="pre">no_encode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.PolygonGTDataset.no_encode" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates an unencoded dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.PolygonGTDataset.parse">
<span class="sig-name descname"><span class="pre">parse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">text</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">baseline</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">boundary</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.PolygonGTDataset.parse" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses a sample for the dataset and returns it.</p>
<p>This function is mainly uses for parallelized loading of training data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>path</em>) – Path to the whole page image</p></li>
<li><p><strong>text</strong> (<em>str</em>) – Transcription of the line.</p></li>
<li><p><strong>baseline</strong> (<em>list</em>) – A list of coordinates [[x0, y0], …, [xn, yn]].</p></li>
<li><p><strong>boundary</strong> (<em>list</em>) – A polygon mask for the line.</p></li>
<li><p><strong>image</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>PIL.Image.Image</em><em>]</em>) – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.train.PytorchCodec">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">PytorchCodec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">charset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.PytorchCodec" title="Permalink to this definition">¶</a></dt>
<dd><p>Translates between labels and graphemes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>charset</strong> (<em>Union</em><em>[</em><em>Dict</em><em>[</em><em>str</em><em>, </em><em>Sequence</em><em>[</em><em>int</em><em>]</em><em>]</em><em>, </em><em>Sequence</em><em>[</em><em>str</em><em>]</em><em>, </em><em>str</em><em>]</em>) – </p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.PytorchCodec.add_labels">
<span class="sig-name descname"><span class="pre">add_labels</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">charset</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.PytorchCodec.add_labels" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds additional characters/labels to the codec.</p>
<p>charset may either be a string, a list or a dict. In the first case
each code point will be assigned a label, in the second case each
string in the list will be assigned a label, and in the final case each
key string will be mapped to the value sequence of integers. In the
first two cases labels will be assigned automatically.</p>
<p>As 0 is the blank label in a CTC output layer, output labels and input
dictionaries are/should be 1-indexed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>charset</strong> (<em>unicode</em><em>, </em><em>list</em><em>, </em><em>dict</em>) – Input character set.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference internal" href="#kraken.lib.train.PytorchCodec" title="kraken.lib.train.PytorchCodec">PytorchCodec</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.PytorchCodec.decode">
<span class="sig-name descname"><span class="pre">decode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.PytorchCodec.decode" title="Permalink to this definition">¶</a></dt>
<dd><p>Decodes a labelling.</p>
<p>Given a labelling with cuts and  confidences returns a string with the
cuts and confidences aggregated across label-code point
correspondences. When decoding multilabels to code points the resulting
cuts are min/max, confidences are averaged.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>labels</strong> (<em>list</em>) – Input containing tuples (label, start, end,
confidence).</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list of tuples (code point, start, end, confidence)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.PytorchCodec.encode">
<span class="sig-name descname"><span class="pre">encode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">s</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.PytorchCodec.encode" title="Permalink to this definition">¶</a></dt>
<dd><p>Encodes a string into a sequence of labels.</p>
<p>If the code is non-singular we greedily encode the longest sequence first.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>s</strong> (<em>str</em>) – Input unicode string</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>(torch.IntTensor) encoded label sequence</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>torch.IntTensor</p>
</dd>
</dl>
<p>Raises:</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.PytorchCodec.is_valid">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">is_valid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.PytorchCodec.is_valid" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if the codec is prefix-free (in label space) and
non-singular (in both directions).</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.PytorchCodec.max_label">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">max_label</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.PytorchCodec.max_label" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the maximum label value.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.PytorchCodec.merge">
<span class="sig-name descname"><span class="pre">merge</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">codec</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.PytorchCodec.merge" title="Permalink to this definition">¶</a></dt>
<dd><p>Transforms this codec (c1) into another (c2) reusing as many labels as
possible.</p>
<p>The resulting codec is able to encode the same code point sequences
while not necessarily having the same labels for them as c2.
Retains matching character -&gt; label mappings from both codecs, removes
mappings not c2, and adds mappings not in c1. Compound labels in c2 for
code point sequences not in c1 containing labels also in use in c1 are
added as separate labels.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>codec</strong> (<a class="reference internal" href="#kraken.lib.codec.PytorchCodec" title="kraken.lib.codec.PytorchCodec"><em>kraken.lib.codec.PytorchCodec</em></a>) – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A merged codec and a list of labels that were removed from the
original codec.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Tuple[<a class="reference internal" href="#kraken.lib.train.PytorchCodec" title="kraken.lib.train.PytorchCodec">PytorchCodec</a>, Set]</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.train.TrainScheduler">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">TrainScheduler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">optimizer</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.TrainScheduler" title="Permalink to this definition">¶</a></dt>
<dd><p>Implements learning rate scheduling.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>optimizer</strong> (<em>torch.optim.Optimizer</em>) – </p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.TrainScheduler.add_phase">
<span class="sig-name descname"><span class="pre">add_phase</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">steps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">annealing_fn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.TrainScheduler.add_phase" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a new phase to the scheduler.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>steps</strong> (<em>int</em>) – Number of step for this scheduler. Can be epochs or
iteration depending on the scheduler.</p></li>
<li><p><strong>max_lr</strong> (<em>float</em>) – Peak learning rate</p></li>
<li><p><strong>annealing_fn</strong> (<em>Callable</em>) – LR change function.</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.TrainScheduler.batch_step">
<span class="sig-name descname"><span class="pre">batch_step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.TrainScheduler.batch_step" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs an optimization step.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>loss</strong> (<em>torch.float</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.TrainScheduler.epoch_step">
<span class="sig-name descname"><span class="pre">epoch_step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_loss</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.TrainScheduler.epoch_step" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs an optimization step.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>val_loss</strong> (<em>torch.float</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.train.TrainStopper">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">TrainStopper</span></span><a class="headerlink" href="#kraken.lib.train.TrainStopper" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.TrainStopper.trigger">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">trigger</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.TrainStopper.trigger" title="Permalink to this definition">¶</a></dt>
<dd><p>Function that raises a KrakenStopTrainingException after if the abort
condition is fulfilled.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.TrainStopper.update">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_loss</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.TrainStopper.update" title="Permalink to this definition">¶</a></dt>
<dd><p>Updates the internal state of the train stopper.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>val_loss</strong> (<em>torch.float</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.train.annealing_const">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">annealing_const</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.annealing_const" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.annealing_const.call_frequency">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">call_frequency</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.annealing_const.call_frequency" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.train.annealing_cosine">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">annealing_cosine</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">optimizer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t_max</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eta_min</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1e-07</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.annealing_cosine" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.annealing_cosine.call_frequency">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">call_frequency</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.annealing_cosine.call_frequency" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.train.annealing_exponential">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">annealing_exponential</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">optimizer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gamma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.annealing_exponential" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.annealing_exponential.call_frequency">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">call_frequency</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.annealing_exponential.call_frequency" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.train.annealing_onecycle">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">annealing_onecycle</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">optimizer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_lr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epochs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">steps_per_epoch</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.annealing_onecycle" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.annealing_onecycle.call_frequency">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">call_frequency</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.annealing_onecycle.call_frequency" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.train.annealing_reduceonplateau">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">annealing_reduceonplateau</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">optimizer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">patience</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'max'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_lr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1e-07</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.annealing_reduceonplateau" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.annealing_reduceonplateau.call_frequency">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">call_frequency</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.annealing_reduceonplateau.call_frequency" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.train.annealing_step">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">annealing_step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">optimizer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gamma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.annealing_step" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.annealing_step.call_frequency">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">call_frequency</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.annealing_step.call_frequency" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.train.baseline_label_evaluator_fn">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">baseline_label_evaluator_fn</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_loader</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.baseline_label_evaluator_fn" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.train.baseline_label_loss_fn">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">baseline_label_loss_fn</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">criterion</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.baseline_label_loss_fn" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.train.collate_sequences">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">collate_sequences</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.collate_sequences" title="Permalink to this definition">¶</a></dt>
<dd><p>Sorts and pads sequences.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.train.compute_error">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">compute_error</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validation_set</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.compute_error" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes error report from a model and a list of line image-text pairs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> (<a class="reference internal" href="#kraken.lib.models.TorchSeqRecognizer" title="kraken.lib.models.TorchSeqRecognizer"><em>kraken.lib.models.TorchSeqRecognizer</em></a>) – Model used for recognition</p></li>
<li><p><strong>validation_set</strong> (<em>list</em>) – List of tuples (image, text) for validation</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tuple with total number of characters and edit distance across the
whole validation set.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Tuple[int, int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.train.generate_input_transforms">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">generate_input_transforms</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">height</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">width</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pad</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">valid_norm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_binarization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.generate_input_transforms" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a torchvision transformation converting a PIL.Image into a
tensor usable in a network forward pass.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>batch</strong> (<em>int</em>) – mini-batch size</p></li>
<li><p><strong>height</strong> (<em>int</em>) – height of input image in pixels</p></li>
<li><p><strong>width</strong> (<em>int</em>) – width of input image in pixels</p></li>
<li><p><strong>channels</strong> (<em>int</em>) – color channels of input</p></li>
<li><p><strong>pad</strong> (<em>int</em>) – Amount of padding on horizontal ends of image</p></li>
<li><p><strong>valid_norm</strong> (<em>bool</em>) – Enables/disables baseline normalization as a valid
preprocessing step. If disabled we will fall back to
standard scaling.</p></li>
<li><p><strong>force_binarization</strong> (<em>bool</em>) – Forces binarization of input images using
the nlbin algorithm.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A torchvision transformation composition converting the input image to
the appropriate tensor.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>torchvision.transforms.Compose</p>
</dd>
</dl>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="kraken.lib.train.logger">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">logger</span></span><a class="headerlink" href="#kraken.lib.train.logger" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.train.make_printable">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">make_printable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">char</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.make_printable" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes a Unicode code point and return a printable representation of it.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>char</strong> (<em>str</em>) – Input code point</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Either the original code point, the name of the code point if it is a
combining mark, whitespace etc., or the hex code if it is a control
symbol.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.train.preparse_xml_data">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">preparse_xml_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filenames</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">format_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'xml'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">repolygonize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.preparse_xml_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads training data from a set of xml files.</p>
<p>Extracts line information from Page/ALTO xml files for training of
recognition models.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filenames</strong> (<em>list</em>) – List of XML files.</p></li>
<li><p><strong>format_type</strong> (<em>str</em>) – Either <cite>page</cite>, <cite>alto</cite> or <cite>xml</cite> for
autodetermination.</p></li>
<li><p><strong>repolygonize</strong> (<em>bool</em>) – (Re-)calculates polygon information using the
kraken algorithm.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>text, ‘baseline’: [[x0, y0], …], ‘boundary’:
[[x0, y0], …], ‘image’: PIL.Image}.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>A list of dicts {‘text’</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.train.recognition_evaluator_fn">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">recognition_evaluator_fn</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_loader</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.recognition_evaluator_fn" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.train.recognition_loss_fn">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">recognition_loss_fn</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">criterion</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.recognition_loss_fn" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.train.validate_hyper_parameters">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">validate_hyper_parameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hyper_params</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.validate_hyper_parameters" title="Permalink to this definition">¶</a></dt>
<dd><p>Validate some model’s hyper parameters and modify them in place if need be.</p>
</dd></dl>

</section>
<section id="module-kraken.binarization">
<span id="kraken-binarization-module"></span><h2>kraken.binarization module<a class="headerlink" href="#module-kraken.binarization" title="Permalink to this headline">¶</a></h2>
<section id="kraken-binarization">
<h3>kraken.binarization<a class="headerlink" href="#kraken-binarization" title="Permalink to this headline">¶</a></h3>
<p>An adaptive binarization algorithm.</p>
<dl class="py exception">
<dt class="sig sig-object py" id="kraken.binarization.KrakenInputException">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.binarization.</span></span><span class="sig-name descname"><span class="pre">KrakenInputException</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.binarization.KrakenInputException" title="Permalink to this definition">¶</a></dt>
<dd><p>Common base class for all non-exit exceptions.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.binarization.array2pil">
<span class="sig-prename descclassname"><span class="pre">kraken.binarization.</span></span><span class="sig-name descname"><span class="pre">array2pil</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.binarization.array2pil" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>a</strong> (<em>numpy.ndarray</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>PIL.Image.Image</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.binarization.get_im_str">
<span class="sig-prename descclassname"><span class="pre">kraken.binarization.</span></span><span class="sig-name descname"><span class="pre">get_im_str</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.binarization.get_im_str" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>im</strong> (<em>PIL.Image.Image</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.binarization.is_bitonal">
<span class="sig-prename descclassname"><span class="pre">kraken.binarization.</span></span><span class="sig-name descname"><span class="pre">is_bitonal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.binarization.is_bitonal" title="Permalink to this definition">¶</a></dt>
<dd><p>Tests a PIL.Image for bitonality.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>im</strong> (<em>PIL.Image.Image</em>) – Image to test</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>True if the image contains only two different color values. False
otherwise.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="kraken.binarization.logger">
<span class="sig-prename descclassname"><span class="pre">kraken.binarization.</span></span><span class="sig-name descname"><span class="pre">logger</span></span><a class="headerlink" href="#kraken.binarization.logger" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.binarization.nlbin">
<span class="sig-prename descclassname"><span class="pre">kraken.binarization.</span></span><span class="sig-name descname"><span class="pre">nlbin</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">zoom</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">escale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">border</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">perc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">80</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">low</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">high</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">90</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.binarization.nlbin" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs binarization using non-linear processing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>PIL.Image.Image</em>) – </p></li>
<li><p><strong>threshold</strong> (<em>float</em>) – </p></li>
<li><p><strong>zoom</strong> (<em>float</em>) – Zoom for background page estimation</p></li>
<li><p><strong>escale</strong> (<em>float</em>) – Scale for estimating a mask over the text region</p></li>
<li><p><strong>border</strong> (<em>float</em>) – Ignore this much of the border</p></li>
<li><p><strong>perc</strong> (<em>int</em>) – Percentage for filters</p></li>
<li><p><strong>range</strong> (<em>int</em>) – Range for filters</p></li>
<li><p><strong>low</strong> (<em>int</em>) – Percentile for black estimation</p></li>
<li><p><strong>high</strong> (<em>int</em>) – Percentile for white estimation</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>PIL.Image.Image containing the binarized image</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><strong>KrakenInputException when trying to binarize an empty image.</strong> – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>PIL.Image.Image</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.binarization.pil2array">
<span class="sig-prename descclassname"><span class="pre">kraken.binarization.</span></span><span class="sig-name descname"><span class="pre">pil2array</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.binarization.pil2array" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>PIL.Image.Image</em>) – </p></li>
<li><p><strong>alpha</strong> (<em>int</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="module-kraken.transcribe">
<span id="kraken-transcribe-module"></span><h2>kraken.transcribe module<a class="headerlink" href="#module-kraken.transcribe" title="Permalink to this headline">¶</a></h2>
<p>Utility functions for ground truth transcription.</p>
<dl class="py exception">
<dt class="sig sig-object py" id="kraken.transcribe.KrakenInputException">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.transcribe.</span></span><span class="sig-name descname"><span class="pre">KrakenInputException</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.transcribe.KrakenInputException" title="Permalink to this definition">¶</a></dt>
<dd><p>Common base class for all non-exit exceptions.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.transcribe.TranscriptionInterface">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.transcribe.</span></span><span class="sig-name descname"><span class="pre">TranscriptionInterface</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">font</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">font_style</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.transcribe.TranscriptionInterface" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="kraken.transcribe.TranscriptionInterface.add_page">
<span class="sig-name descname"><span class="pre">add_page</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">segmentation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">records</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.transcribe.TranscriptionInterface.add_page" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds an image to the transcription interface, optionally filling in
information from a list of ocr_record objects.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>PIL.Image</em>) – Input image</p></li>
<li><p><strong>segmentation</strong> (<em>dict</em>) – Output of the segment method.</p></li>
<li><p><strong>records</strong> (<em>list</em>) – A list of ocr_record objects.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.transcribe.TranscriptionInterface.write">
<span class="sig-name descname"><span class="pre">write</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fd</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.transcribe.TranscriptionInterface.write" title="Permalink to this definition">¶</a></dt>
<dd><p>Writes the HTML file to a file descriptor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>fd</strong> (<em>File</em>) – File descriptor (mode=’rb’) to write to.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.transcribe.get_im_str">
<span class="sig-prename descclassname"><span class="pre">kraken.transcribe.</span></span><span class="sig-name descname"><span class="pre">get_im_str</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.transcribe.get_im_str" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>im</strong> (<em>PIL.Image.Image</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="kraken.transcribe.logger">
<span class="sig-prename descclassname"><span class="pre">kraken.transcribe.</span></span><span class="sig-name descname"><span class="pre">logger</span></span><a class="headerlink" href="#kraken.transcribe.logger" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="module-kraken.linegen">
<span id="kraken-linegen-module"></span><h2>kraken.linegen module<a class="headerlink" href="#module-kraken.linegen" title="Permalink to this headline">¶</a></h2>
<section id="linegen">
<h3>linegen<a class="headerlink" href="#linegen" title="Permalink to this headline">¶</a></h3>
<p>An advanced line generation tool using Pango for proper text shaping. The
actual drawing code was adapted from the create_image utility from nototools
available at [0].</p>
<p>Line degradation uses a local model described in [1].</p>
<p>[0] <a class="reference external" href="https://github.com/googlei18n/nototools">https://github.com/googlei18n/nototools</a>
[1] Kanungo, Tapas, et al. “A statistical, nonparametric methodology for
document degradation model validation.” IEEE Transactions on Pattern Analysis
and Machine Intelligence 22.11 (2000): 1209-1223.</p>
<dl class="py class">
<dt class="sig sig-object py" id="kraken.linegen.CairoContext">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">CairoContext</span></span><a class="headerlink" href="#kraken.linegen.CairoContext" title="Permalink to this definition">¶</a></dt>
<dd><p>Structure base class</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.linegen.CairoSurface">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">CairoSurface</span></span><a class="headerlink" href="#kraken.linegen.CairoSurface" title="Permalink to this definition">¶</a></dt>
<dd><p>Structure base class</p>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="kraken.linegen.KrakenCairoSurfaceException">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">KrakenCairoSurfaceException</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">width</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">height</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.linegen.KrakenCairoSurfaceException" title="Permalink to this definition">¶</a></dt>
<dd><p>Raised when the Cairo surface couldn’t be created.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>message</strong> (<em>str</em>) – </p></li>
<li><p><strong>width</strong> (<em>int</em>) – </p></li>
<li><p><strong>height</strong> (<em>int</em>) – </p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="kraken.linegen.KrakenCairoSurfaceException.message">
<span class="sig-name descname"><span class="pre">message</span></span><a class="headerlink" href="#kraken.linegen.KrakenCairoSurfaceException.message" title="Permalink to this definition">¶</a></dt>
<dd><p>Error message</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="kraken.linegen.KrakenCairoSurfaceException.width">
<span class="sig-name descname"><span class="pre">width</span></span><a class="headerlink" href="#kraken.linegen.KrakenCairoSurfaceException.width" title="Permalink to this definition">¶</a></dt>
<dd><p>Width of the surface</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="kraken.linegen.KrakenCairoSurfaceException.height">
<span class="sig-name descname"><span class="pre">height</span></span><a class="headerlink" href="#kraken.linegen.KrakenCairoSurfaceException.height" title="Permalink to this definition">¶</a></dt>
<dd><p>Height of the surface</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.linegen.LineGenerator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">LineGenerator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">family</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Sans'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">font_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">32</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">font_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">400</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">language</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.linegen.LineGenerator" title="Permalink to this definition">¶</a></dt>
<dd><p>Produces degraded line images using a single collection of font families.</p>
<dl class="py method">
<dt class="sig sig-object py" id="kraken.linegen.LineGenerator.render_line">
<span class="sig-name descname"><span class="pre">render_line</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">text</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.linegen.LineGenerator.render_line" title="Permalink to this definition">¶</a></dt>
<dd><p>Draws a line onto a Cairo surface which will be converted to an pillow
Image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>text</strong> (<em>unicode</em>) – A string which will be rendered as a single line.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>PIL.Image of mode ‘L’.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>KrakenCairoSurfaceException if the Cairo surface couldn't be created</strong> – </p></li>
<li><p><strong>(</strong><strong>usually caused by invalid dimensions.</strong> – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.linegen.PangoContext">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">PangoContext</span></span><a class="headerlink" href="#kraken.linegen.PangoContext" title="Permalink to this definition">¶</a></dt>
<dd><p>Structure base class</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.linegen.PangoFontDescription">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">PangoFontDescription</span></span><a class="headerlink" href="#kraken.linegen.PangoFontDescription" title="Permalink to this definition">¶</a></dt>
<dd><p>Structure base class</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.linegen.PangoLanguage">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">PangoLanguage</span></span><a class="headerlink" href="#kraken.linegen.PangoLanguage" title="Permalink to this definition">¶</a></dt>
<dd><p>Structure base class</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.linegen.PangoLayout">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">PangoLayout</span></span><a class="headerlink" href="#kraken.linegen.PangoLayout" title="Permalink to this definition">¶</a></dt>
<dd><p>Structure base class</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.linegen.PangoRectangle">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">PangoRectangle</span></span><a class="headerlink" href="#kraken.linegen.PangoRectangle" title="Permalink to this definition">¶</a></dt>
<dd><p>Structure base class</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="kraken.linegen.argtypes">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">argtypes</span></span><a class="headerlink" href="#kraken.linegen.argtypes" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id2">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">argtypes</span></span><a class="headerlink" href="#id2" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id3">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">argtypes</span></span><a class="headerlink" href="#id3" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id4">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">argtypes</span></span><a class="headerlink" href="#id4" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id5">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">argtypes</span></span><a class="headerlink" href="#id5" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id6">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">argtypes</span></span><a class="headerlink" href="#id6" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id7">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">argtypes</span></span><a class="headerlink" href="#id7" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id8">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">argtypes</span></span><a class="headerlink" href="#id8" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id9">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">argtypes</span></span><a class="headerlink" href="#id9" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id10">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">argtypes</span></span><a class="headerlink" href="#id10" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id11">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">argtypes</span></span><a class="headerlink" href="#id11" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id12">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">argtypes</span></span><a class="headerlink" href="#id12" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id13">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">argtypes</span></span><a class="headerlink" href="#id13" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id14">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">argtypes</span></span><a class="headerlink" href="#id14" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id15">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">argtypes</span></span><a class="headerlink" href="#id15" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id16">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">argtypes</span></span><a class="headerlink" href="#id16" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id17">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">argtypes</span></span><a class="headerlink" href="#id17" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id18">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">argtypes</span></span><a class="headerlink" href="#id18" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.linegen.array2pil">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">array2pil</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.linegen.array2pil" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>a</strong> (<em>numpy.ndarray</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>PIL.Image.Image</p>
</dd>
</dl>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="kraken.linegen.c_lib">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">c_lib</span></span><a class="headerlink" href="#kraken.linegen.c_lib" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="kraken.linegen.cairo">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">cairo</span></span><a class="headerlink" href="#kraken.linegen.cairo" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.linegen.degrade_line">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">degrade_line</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha_0</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beta_0</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.linegen.degrade_line" title="Permalink to this definition">¶</a></dt>
<dd><p>Degrades a line image by adding noise.</p>
<p>For parameter meanings consult [1].</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>PIL.Image</em>) – Input image</p></li>
<li><p><strong>eta</strong> (<em>float</em>) – </p></li>
<li><p><strong>alpha</strong> (<em>float</em>) – </p></li>
<li><p><strong>beta</strong> (<em>float</em>) – </p></li>
<li><p><strong>alpha_0</strong> (<em>float</em>) – </p></li>
<li><p><strong>beta_0</strong> (<em>float</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>PIL.Image in mode ‘1’</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.linegen.distort_line">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">distort_line</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distort</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.03</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.3</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.linegen.distort_line" title="Permalink to this definition">¶</a></dt>
<dd><p>Distorts a line image.</p>
<p>Run BEFORE degrade_line as a white border of 5 pixels will be added.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>PIL.Image</em>) – Input image</p></li>
<li><p><strong>distort</strong> (<em>float</em>) – </p></li>
<li><p><strong>sigma</strong> (<em>float</em>) – </p></li>
<li><p><strong>eps</strong> (<em>float</em>) – </p></li>
<li><p><strong>delta</strong> (<em>float</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>PIL.Image in mode ‘L’</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.linegen.ensureBytes">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">ensureBytes</span></span><a class="headerlink" href="#kraken.linegen.ensureBytes" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple class ensuring the arguments of type char * are actually a series of
bytes.</p>
<dl class="py method">
<dt class="sig sig-object py" id="kraken.linegen.ensureBytes.from_param">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_param</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cls</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.linegen.ensureBytes.from_param" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>value</strong> (<em>AnyStr</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>bytes</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="kraken.linegen.logger">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">logger</span></span><a class="headerlink" href="#kraken.linegen.logger" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.linegen.ocropy_degrade">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">ocropy_degrade</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distort</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dsigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.03</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">degradations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">((0.5,</span> <span class="pre">0.0,</span> <span class="pre">0.5,</span> <span class="pre">0.0),)</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.linegen.ocropy_degrade" title="Permalink to this definition">¶</a></dt>
<dd><p>Degrades and distorts a line using the same noise model used by ocropus.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>PIL.Image</em>) – Input image</p></li>
<li><p><strong>distort</strong> (<em>float</em>) – </p></li>
<li><p><strong>dsigma</strong> (<em>float</em>) – </p></li>
<li><p><strong>eps</strong> (<em>float</em>) – </p></li>
<li><p><strong>delta</strong> (<em>float</em>) – </p></li>
<li><p><strong>degradations</strong> (<em>list</em>) – list returning 4-tuples corresponding to
the degradations argument of ocropus-linegen.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>PIL.Image in mode ‘L’</p>
</dd>
</dl>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="kraken.linegen.p_lib">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">p_lib</span></span><a class="headerlink" href="#kraken.linegen.p_lib" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="kraken.linegen.pango">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">pango</span></span><a class="headerlink" href="#kraken.linegen.pango" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="kraken.linegen.pangocairo">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">pangocairo</span></span><a class="headerlink" href="#kraken.linegen.pangocairo" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="kraken.linegen.pc_lib">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">pc_lib</span></span><a class="headerlink" href="#kraken.linegen.pc_lib" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.linegen.pil2array">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">pil2array</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.linegen.pil2array" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>PIL.Image.Image</em>) – </p></li>
<li><p><strong>alpha</strong> (<em>int</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="kraken.linegen.restype">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">restype</span></span><a class="headerlink" href="#kraken.linegen.restype" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id19">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">restype</span></span><a class="headerlink" href="#id19" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id20">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">restype</span></span><a class="headerlink" href="#id20" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id21">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">restype</span></span><a class="headerlink" href="#id21" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id22">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">restype</span></span><a class="headerlink" href="#id22" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id23">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">restype</span></span><a class="headerlink" href="#id23" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id24">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">restype</span></span><a class="headerlink" href="#id24" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id25">
<span class="sig-prename descclassname"><span class="pre">kraken.linegen.</span></span><span class="sig-name descname"><span class="pre">restype</span></span><a class="headerlink" href="#id25" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</section>
</section>
<section id="module-kraken.lib.dataset">
<span id="kraken-lib-dataset-module"></span><h2>kraken.lib.dataset module<a class="headerlink" href="#module-kraken.lib.dataset" title="Permalink to this headline">¶</a></h2>
<p>Utility functions for data loading and training of VGSL networks.</p>
<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.dataset.BaselineSet">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.dataset.</span></span><span class="sig-name descname"><span class="pre">BaselineSet</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">imgs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">suffix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'.path'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">line_width</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">im_transforms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">transforms.Compose([])</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'path'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">augmentation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">valid_baselines</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">merge_baselines</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">valid_regions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">merge_regions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.BaselineSet" title="Permalink to this definition">¶</a></dt>
<dd><p>Dataset for training a baseline/region segmentation model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>imgs</strong> (<em>Sequence</em><em>[</em><em>str</em><em>]</em>) – </p></li>
<li><p><strong>suffix</strong> (<em>str</em>) – </p></li>
<li><p><strong>line_width</strong> (<em>int</em>) – </p></li>
<li><p><strong>im_transforms</strong> (<em>Callable</em><em>[</em><em>[</em><em>Any</em><em>]</em><em>, </em><em>torch.Tensor</em><em>]</em>) – </p></li>
<li><p><strong>mode</strong> (<em>str</em>) – </p></li>
<li><p><strong>augmentation</strong> (<em>bool</em>) – </p></li>
<li><p><strong>valid_baselines</strong> (<em>Sequence</em><em>[</em><em>str</em><em>]</em>) – </p></li>
<li><p><strong>merge_baselines</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>Sequence</em><em>[</em><em>str</em><em>]</em><em>]</em>) – </p></li>
<li><p><strong>valid_regions</strong> (<em>Sequence</em><em>[</em><em>str</em><em>]</em>) – </p></li>
<li><p><strong>merge_regions</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>Sequence</em><em>[</em><em>str</em><em>]</em><em>]</em>) – </p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.dataset.BaselineSet.add">
<span class="sig-name descname"><span class="pre">add</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">baselines</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.BaselineSet.add" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a page to the dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>path</em>) – Path to the whole page image</p></li>
<li><p><strong>baseline</strong> (<em>dict</em>) – A list containing dicts with a list of coordinates
and script types [{‘baseline’: [[x0, y0], …,
[xn, yn]], ‘script’: ‘script_type’}, …]</p></li>
<li><p><strong>regions</strong> (<em>dict</em>) – A dict containing list of lists of coordinates
{‘region_type_0’: [[x0, y0], …, [xn, yn]]],
‘region_type_1’: …}.</p></li>
<li><p><strong>image</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>PIL.Image.Image</em><em>]</em>) – </p></li>
<li><p><strong>baselines</strong> (<em>List</em><em>[</em><em>List</em><em>[</em><em>List</em><em>[</em><em>Tuple</em><em>[</em><em>int</em><em>, </em><em>int</em><em>]</em><em>]</em><em>]</em><em>]</em>) – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.dataset.BaselineSet.transform">
<span class="sig-name descname"><span class="pre">transform</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.BaselineSet.transform" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.dataset.CenterNormalizer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.dataset.</span></span><span class="sig-name descname"><span class="pre">CenterNormalizer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target_height</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">48</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(4,</span> <span class="pre">1.0,</span> <span class="pre">0.3)</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.CenterNormalizer" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.dataset.CenterNormalizer.dewarp">
<span class="sig-name descname"><span class="pre">dewarp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cval</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">np.dtype('f')</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.CenterNormalizer.dewarp" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.dataset.CenterNormalizer.measure">
<span class="sig-name descname"><span class="pre">measure</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">line</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.CenterNormalizer.measure" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.dataset.CenterNormalizer.normalize">
<span class="sig-name descname"><span class="pre">normalize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">np.dtype('f')</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cval</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.CenterNormalizer.normalize" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.dataset.CenterNormalizer.setHeight">
<span class="sig-name descname"><span class="pre">setHeight</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_height</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.CenterNormalizer.setHeight" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.dataset.GroundTruthDataset">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.dataset.</span></span><span class="sig-name descname"><span class="pre">GroundTruthDataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">split</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">F_t.default_split</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">suffix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'.gt.txt'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">whitespace_normalization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reorder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">im_transforms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">transforms.Compose([])</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">preload</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">augmentation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.GroundTruthDataset" title="Permalink to this definition">¶</a></dt>
<dd><p>Dataset for training a line recognition model.</p>
<p>All data is cached in memory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>split</strong> (<em>Callable</em><em>[</em><em>[</em><em>str</em><em>]</em><em>, </em><em>str</em><em>]</em>) – </p></li>
<li><p><strong>suffix</strong> (<em>str</em>) – </p></li>
<li><p><strong>normalization</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em>) – </p></li>
<li><p><strong>whitespace_normalization</strong> (<em>bool</em>) – </p></li>
<li><p><strong>reorder</strong> (<em>Union</em><em>[</em><em>bool</em><em>, </em><em>str</em><em>]</em>) – </p></li>
<li><p><strong>im_transforms</strong> (<em>Callable</em><em>[</em><em>[</em><em>Any</em><em>]</em><em>, </em><em>torch.Tensor</em><em>]</em>) – </p></li>
<li><p><strong>preload</strong> (<em>bool</em>) – </p></li>
<li><p><strong>augmentation</strong> (<em>bool</em>) – </p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.dataset.GroundTruthDataset.add">
<span class="sig-name descname"><span class="pre">add</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.GroundTruthDataset.add" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a line-image-text pair to the dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>image</strong> (<em>str</em>) – Input image path</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.dataset.GroundTruthDataset.add_loaded">
<span class="sig-name descname"><span class="pre">add_loaded</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gt</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.GroundTruthDataset.add_loaded" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds an already loaded line-image-text pair to the dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<em>PIL.Image.Image</em>) – Line image</p></li>
<li><p><strong>gt</strong> (<em>str</em>) – Text contained in the line image</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.dataset.GroundTruthDataset.encode">
<span class="sig-name descname"><span class="pre">encode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">codec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.GroundTruthDataset.encode" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a codec to the dataset and encodes all text lines.</p>
<p>Has to be run before sampling from the dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>codec</strong> (<em>Optional</em><em>[</em><a class="reference internal" href="#kraken.lib.codec.PytorchCodec" title="kraken.lib.codec.PytorchCodec"><em>kraken.lib.codec.PytorchCodec</em></a><em>]</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.dataset.GroundTruthDataset.no_encode">
<span class="sig-name descname"><span class="pre">no_encode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.GroundTruthDataset.no_encode" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates an unencoded dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.dataset.GroundTruthDataset.parse">
<span class="sig-name descname"><span class="pre">parse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.GroundTruthDataset.parse" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses a sample for this dataset.</p>
<p>This is mostly used to parallelize populating the dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>image</strong> (<em>str</em>) – Input image path</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>Dict</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.dataset.InfiniteDataLoader">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.dataset.</span></span><span class="sig-name descname"><span class="pre">InfiniteDataLoader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.InfiniteDataLoader" title="Permalink to this definition">¶</a></dt>
<dd><p>Version of DataLoader that auto-reinitializes the iterator once it is
exhausted.</p>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="kraken.lib.dataset.KrakenInputException">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.dataset.</span></span><span class="sig-name descname"><span class="pre">KrakenInputException</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.KrakenInputException" title="Permalink to this definition">¶</a></dt>
<dd><p>Common base class for all non-exit exceptions.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.dataset.PolygonGTDataset">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.dataset.</span></span><span class="sig-name descname"><span class="pre">PolygonGTDataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">normalization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">whitespace_normalization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reorder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">im_transforms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">transforms.Compose([])</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">preload</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">augmentation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.PolygonGTDataset" title="Permalink to this definition">¶</a></dt>
<dd><p>Dataset for training a line recognition model from polygonal/baseline data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>normalization</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em>) – </p></li>
<li><p><strong>whitespace_normalization</strong> (<em>bool</em>) – </p></li>
<li><p><strong>reorder</strong> (<em>Union</em><em>[</em><em>bool</em><em>, </em><em>str</em><em>]</em>) – </p></li>
<li><p><strong>im_transforms</strong> (<em>Callable</em><em>[</em><em>[</em><em>Any</em><em>]</em><em>, </em><em>torch.Tensor</em><em>]</em>) – </p></li>
<li><p><strong>preload</strong> (<em>bool</em>) – </p></li>
<li><p><strong>augmentation</strong> (<em>bool</em>) – </p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.dataset.PolygonGTDataset.add">
<span class="sig-name descname"><span class="pre">add</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.PolygonGTDataset.add" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a line to the dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>path</em>) – Path to the whole page image</p></li>
<li><p><strong>text</strong> (<em>str</em>) – Transcription of the line.</p></li>
<li><p><strong>baseline</strong> (<em>list</em>) – A list of coordinates [[x0, y0], …, [xn, yn]].</p></li>
<li><p><strong>boundary</strong> (<em>list</em>) – A polygon mask for the line.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.dataset.PolygonGTDataset.encode">
<span class="sig-name descname"><span class="pre">encode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">codec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.PolygonGTDataset.encode" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a codec to the dataset and encodes all text lines.</p>
<p>Has to be run before sampling from the dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>codec</strong> (<em>Optional</em><em>[</em><a class="reference internal" href="#kraken.lib.codec.PytorchCodec" title="kraken.lib.codec.PytorchCodec"><em>kraken.lib.codec.PytorchCodec</em></a><em>]</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.dataset.PolygonGTDataset.no_encode">
<span class="sig-name descname"><span class="pre">no_encode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.PolygonGTDataset.no_encode" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates an unencoded dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.dataset.PolygonGTDataset.parse">
<span class="sig-name descname"><span class="pre">parse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">text</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">baseline</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">boundary</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.PolygonGTDataset.parse" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses a sample for the dataset and returns it.</p>
<p>This function is mainly uses for parallelized loading of training data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>path</em>) – Path to the whole page image</p></li>
<li><p><strong>text</strong> (<em>str</em>) – Transcription of the line.</p></li>
<li><p><strong>baseline</strong> (<em>list</em>) – A list of coordinates [[x0, y0], …, [xn, yn]].</p></li>
<li><p><strong>boundary</strong> (<em>list</em>) – A polygon mask for the line.</p></li>
<li><p><strong>image</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>PIL.Image.Image</em><em>]</em>) – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.dataset.PytorchCodec">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.dataset.</span></span><span class="sig-name descname"><span class="pre">PytorchCodec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">charset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.PytorchCodec" title="Permalink to this definition">¶</a></dt>
<dd><p>Translates between labels and graphemes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>charset</strong> (<em>Union</em><em>[</em><em>Dict</em><em>[</em><em>str</em><em>, </em><em>Sequence</em><em>[</em><em>int</em><em>]</em><em>]</em><em>, </em><em>Sequence</em><em>[</em><em>str</em><em>]</em><em>, </em><em>str</em><em>]</em>) – </p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.dataset.PytorchCodec.add_labels">
<span class="sig-name descname"><span class="pre">add_labels</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">charset</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.PytorchCodec.add_labels" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds additional characters/labels to the codec.</p>
<p>charset may either be a string, a list or a dict. In the first case
each code point will be assigned a label, in the second case each
string in the list will be assigned a label, and in the final case each
key string will be mapped to the value sequence of integers. In the
first two cases labels will be assigned automatically.</p>
<p>As 0 is the blank label in a CTC output layer, output labels and input
dictionaries are/should be 1-indexed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>charset</strong> (<em>unicode</em><em>, </em><em>list</em><em>, </em><em>dict</em>) – Input character set.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference internal" href="#kraken.lib.dataset.PytorchCodec" title="kraken.lib.dataset.PytorchCodec">PytorchCodec</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.dataset.PytorchCodec.decode">
<span class="sig-name descname"><span class="pre">decode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.PytorchCodec.decode" title="Permalink to this definition">¶</a></dt>
<dd><p>Decodes a labelling.</p>
<p>Given a labelling with cuts and  confidences returns a string with the
cuts and confidences aggregated across label-code point
correspondences. When decoding multilabels to code points the resulting
cuts are min/max, confidences are averaged.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>labels</strong> (<em>list</em>) – Input containing tuples (label, start, end,
confidence).</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list of tuples (code point, start, end, confidence)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.dataset.PytorchCodec.encode">
<span class="sig-name descname"><span class="pre">encode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">s</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.PytorchCodec.encode" title="Permalink to this definition">¶</a></dt>
<dd><p>Encodes a string into a sequence of labels.</p>
<p>If the code is non-singular we greedily encode the longest sequence first.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>s</strong> (<em>str</em>) – Input unicode string</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>(torch.IntTensor) encoded label sequence</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>torch.IntTensor</p>
</dd>
</dl>
<p>Raises:</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.dataset.PytorchCodec.is_valid">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">is_valid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.PytorchCodec.is_valid" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if the codec is prefix-free (in label space) and
non-singular (in both directions).</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.dataset.PytorchCodec.max_label">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">max_label</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.PytorchCodec.max_label" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the maximum label value.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.dataset.PytorchCodec.merge">
<span class="sig-name descname"><span class="pre">merge</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">codec</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.PytorchCodec.merge" title="Permalink to this definition">¶</a></dt>
<dd><p>Transforms this codec (c1) into another (c2) reusing as many labels as
possible.</p>
<p>The resulting codec is able to encode the same code point sequences
while not necessarily having the same labels for them as c2.
Retains matching character -&gt; label mappings from both codecs, removes
mappings not c2, and adds mappings not in c1. Compound labels in c2 for
code point sequences not in c1 containing labels also in use in c1 are
added as separate labels.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>codec</strong> (<a class="reference internal" href="#kraken.lib.codec.PytorchCodec" title="kraken.lib.codec.PytorchCodec"><em>kraken.lib.codec.PytorchCodec</em></a>) – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A merged codec and a list of labels that were removed from the
original codec.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Tuple[<a class="reference internal" href="#kraken.lib.dataset.PytorchCodec" title="kraken.lib.dataset.PytorchCodec">PytorchCodec</a>, Set]</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.dataset.TorchSeqRecognizer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.dataset.</span></span><span class="sig-name descname"><span class="pre">TorchSeqRecognizer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decoder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">kraken.lib.ctc_decoder.greedy_decoder</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cpu'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.TorchSeqRecognizer" title="Permalink to this definition">¶</a></dt>
<dd><p>A class wrapping a TorchVGSLModel with a more comfortable recognition interface.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>train</strong> (<em>bool</em>) – </p></li>
<li><p><strong>device</strong> (<em>str</em>) – </p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.dataset.TorchSeqRecognizer.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">line</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.TorchSeqRecognizer.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs a forward pass on a torch tensor of one or more lines with
shape (N, C, H, W) and returns a numpy array (N, W, C).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>line</strong> (<em>torch.Tensor</em>) – NCHW line tensor</p></li>
<li><p><strong>lens</strong> (<em>torch.Tensor</em>) – Optional tensor containing sequence lengths if N &gt; 1</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Tuple with (N, W, C) shaped numpy array and final output sequence
lengths.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.dataset.TorchSeqRecognizer.predict">
<span class="sig-name descname"><span class="pre">predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">line</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.TorchSeqRecognizer.predict" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs a forward pass on a torch tensor of a line with shape (N, C, H, W)
and returns the decoding as a list of tuples (string, start, end,
confidence).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>line</strong> (<em>torch.Tensor</em>) – NCHW line tensor</p></li>
<li><p><strong>lens</strong> (<em>torch.Tensor</em>) – Optional tensor containing sequence lengths if N &gt; 1</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>List of decoded sequences.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>List[List[Tuple[str, int, int, float]]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.dataset.TorchSeqRecognizer.predict_labels">
<span class="sig-name descname"><span class="pre">predict_labels</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">line</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.TorchSeqRecognizer.predict_labels" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs a forward pass on a torch tensor of a line with shape (N, C, H, W)
and returns a list of tuples (class, start, end, max). Max is the
maximum value of the softmax layer in the region.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>line</strong> (<em>torch.tensor</em>) – </p></li>
<li><p><strong>lens</strong> (<em>torch.Tensor</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>List[List[Tuple[int, int, int, float]]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.dataset.TorchSeqRecognizer.predict_string">
<span class="sig-name descname"><span class="pre">predict_string</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">line</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.TorchSeqRecognizer.predict_string" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs a forward pass on a torch tensor of a line with shape (N, C, H, W)
and returns a string of the results.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>line</strong> (<em>torch.Tensor</em>) – </p></li>
<li><p><strong>lens</strong> (<em>torch.Tensor</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>List[str]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.dataset.TorchSeqRecognizer.to">
<span class="sig-name descname"><span class="pre">to</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.TorchSeqRecognizer.to" title="Permalink to this definition">¶</a></dt>
<dd><p>Moves model to device and automatically loads input tensors onto it.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.dataset.calculate_polygonal_environment">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.dataset.</span></span><span class="sig-name descname"><span class="pre">calculate_polygonal_environment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">baselines</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">suppl_obj</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">im_feats</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">topline</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.calculate_polygonal_environment" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a list of baselines and an input image, calculates a polygonal
environment around each baseline.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>PIL.Image</em>) – grayscale input image (mode ‘L’)</p></li>
<li><p><strong>baselines</strong> (<em>sequence</em>) – List of lists containing a single baseline per
entry.</p></li>
<li><p><strong>suppl_obj</strong> (<em>sequence</em>) – List of lists containing additional polylines
that should be considered hard boundaries for
polygonizaton purposes. Can be used to prevent
polygonization into non-text areas such as
illustrations or to compute the polygonization of
a subset of the lines in an image.</p></li>
<li><p><strong>im_feats</strong> (<em>numpy.array</em>) – An optional precomputed seamcarve energy map.
Overrides data in <cite>im</cite>. The default map is
<cite>gaussian_filter(sobel(im), 2)</cite>.</p></li>
<li><p><strong>scale</strong> (<em>tuple</em>) – A 2-tuple (h, w) containing optional scale factors of
the input. Values of 0 are used for aspect-preserving
scaling. <cite>None</cite> skips input scaling.</p></li>
<li><p><strong>topline</strong> (<em>bool</em>) – Switch to change default baseline location for offset
calculation purposes. If set to False, baselines are
assumed to be on the bottom of the text line and will
be offset upwards, if set to True, baselines are on the
top and will be offset downwards. If set to None, no
offset will be applied.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>List of lists of coordinates. If no polygonization could be compute for
a baseline <cite>None</cite> is returned instead.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.dataset.collate_sequences">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.dataset.</span></span><span class="sig-name descname"><span class="pre">collate_sequences</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.collate_sequences" title="Permalink to this definition">¶</a></dt>
<dd><p>Sorts and pads sequences.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.dataset.compute_confusions">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.dataset.</span></span><span class="sig-name descname"><span class="pre">compute_confusions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">algn1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">algn2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.compute_confusions" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute confusion matrices from two globally aligned strings.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>align1</strong> (<em>Sequence</em><em>[</em><em>str</em><em>]</em>) – sequence 1</p></li>
<li><p><strong>align2</strong> (<em>Sequence</em><em>[</em><em>str</em><em>]</em>) – sequence 2</p></li>
<li><p><strong>algn1</strong> (<em>Sequence</em><em>[</em><em>str</em><em>]</em>) – </p></li>
<li><p><strong>algn2</strong> (<em>Sequence</em><em>[</em><em>str</em><em>]</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tuple (counts, scripts, ins, dels, subs) with <cite>counts</cite> being per-character
confusions, <cite>scripts</cite> per-script counts, <cite>ins</cite> a dict with per script
insertions, <cite>del</cite> an integer of the number of deletions, <cite>subs</cite> per
script substitutions.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.dataset.compute_error">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.dataset.</span></span><span class="sig-name descname"><span class="pre">compute_error</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validation_set</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.compute_error" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes error report from a model and a list of line image-text pairs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> (<a class="reference internal" href="#kraken.lib.models.TorchSeqRecognizer" title="kraken.lib.models.TorchSeqRecognizer"><em>kraken.lib.models.TorchSeqRecognizer</em></a>) – Model used for recognition</p></li>
<li><p><strong>validation_set</strong> (<em>list</em>) – List of tuples (image, text) for validation</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tuple with total number of characters and edit distance across the
whole validation set.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Tuple[int, int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.dataset.extract_polygons">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.dataset.</span></span><span class="sig-name descname"><span class="pre">extract_polygons</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bounds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.extract_polygons" title="Permalink to this definition">¶</a></dt>
<dd><p>Yields the subimages of image im defined in the list of bounding polygons
with baselines preserving order.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>PIL.Image.Image</em>) – Input image</p></li>
<li><p><strong>bounds</strong> (<em>list</em>) – A list of tuples (x1, y1, x2, y2)</p></li>
</ul>
</dd>
<dt class="field-even">Yields</dt>
<dd class="field-even"><p>(PIL.Image.Image) the extracted subimage</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>PIL.Image.Image</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.dataset.generate_input_transforms">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.dataset.</span></span><span class="sig-name descname"><span class="pre">generate_input_transforms</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">height</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">width</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pad</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">valid_norm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_binarization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.generate_input_transforms" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a torchvision transformation converting a PIL.Image into a
tensor usable in a network forward pass.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>batch</strong> (<em>int</em>) – mini-batch size</p></li>
<li><p><strong>height</strong> (<em>int</em>) – height of input image in pixels</p></li>
<li><p><strong>width</strong> (<em>int</em>) – width of input image in pixels</p></li>
<li><p><strong>channels</strong> (<em>int</em>) – color channels of input</p></li>
<li><p><strong>pad</strong> (<em>int</em>) – Amount of padding on horizontal ends of image</p></li>
<li><p><strong>valid_norm</strong> (<em>bool</em>) – Enables/disables baseline normalization as a valid
preprocessing step. If disabled we will fall back to
standard scaling.</p></li>
<li><p><strong>force_binarization</strong> (<em>bool</em>) – Forces binarization of input images using
the nlbin algorithm.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A torchvision transformation composition converting the input image to
the appropriate tensor.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>torchvision.transforms.Compose</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.dataset.global_align">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.dataset.</span></span><span class="sig-name descname"><span class="pre">global_align</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">seq1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seq2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.global_align" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes a global alignment of two strings.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>seq1</strong> (<em>Sequence</em><em>[</em><em>Any</em><em>]</em>) – </p></li>
<li><p><strong>seq2</strong> (<em>Sequence</em><em>[</em><em>Any</em><em>]</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>Tuple[int, List[str], List[str]]</p>
</dd>
</dl>
<p>Returns a tuple (distance, list(algn1), list(algn2))</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.dataset.is_bitonal">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.dataset.</span></span><span class="sig-name descname"><span class="pre">is_bitonal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.is_bitonal" title="Permalink to this definition">¶</a></dt>
<dd><p>Tests a PIL.Image for bitonality.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>im</strong> (<em>PIL.Image.Image</em>) – Image to test</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>True if the image contains only two different color values. False
otherwise.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="kraken.lib.dataset.logger">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.dataset.</span></span><span class="sig-name descname"><span class="pre">logger</span></span><a class="headerlink" href="#kraken.lib.dataset.logger" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.dataset.parse_alto">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.dataset.</span></span><span class="sig-name descname"><span class="pre">parse_alto</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.parse_alto" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses an ALTO file, returns the baselines defined in it, and loads the
referenced image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>filename</strong> (<em>str</em>) – path to an ALTO file.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>impath, lines: [{‘boundary’: [[x0, y0], …],
‘baseline’: [[x0, y0], …]}, {…], ‘text’: ‘apdjfqpf’, ‘script’:
‘script_type’}, regions: {‘region_type_0’: [[[x0, y0], …], …],
…}, ‘base_dir’: None}</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>A dict {‘image’</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.dataset.parse_page">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.dataset.</span></span><span class="sig-name descname"><span class="pre">parse_page</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.parse_page" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses a PageXML file, returns the baselines defined in it, and loads the
referenced image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>filename</strong> (<em>str</em>) – path to a PageXML file.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>impath, lines: [{‘boundary’: [[x0, y0], …],
‘baseline’: [[x0, y0], …]}, {…], ‘text’: ‘apdjfqpf’, ‘script’:
‘script_type’}, regions: {‘region_type_0’: [[[x0, y0], …], …],
…}}</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>A dict {‘image’</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.dataset.parse_xml">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.dataset.</span></span><span class="sig-name descname"><span class="pre">parse_xml</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.parse_xml" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses either a PageXML or ALTO file with autodetermination of the file
format.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>filename</strong> (<em>str</em>) – path to an XML file.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>impath, lines: [{‘boundary’: [[x0, y0], …],
‘baseline’: [[x0, y0], …]}, {…], ‘text’: ‘apdjfqpf’, ‘script’:
‘script_type’}, regions: {‘region_type_0’: [[[x0, y0], …], …],
…}, ‘base_dir’: None}</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>A dict {‘image’</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.dataset.preparse_xml_data">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.dataset.</span></span><span class="sig-name descname"><span class="pre">preparse_xml_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filenames</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">format_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'xml'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">repolygonize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.preparse_xml_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads training data from a set of xml files.</p>
<p>Extracts line information from Page/ALTO xml files for training of
recognition models.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filenames</strong> (<em>list</em>) – List of XML files.</p></li>
<li><p><strong>format_type</strong> (<em>str</em>) – Either <cite>page</cite>, <cite>alto</cite> or <cite>xml</cite> for
autodetermination.</p></li>
<li><p><strong>repolygonize</strong> (<em>bool</em>) – (Re-)calculates polygon information using the
kraken algorithm.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>text, ‘baseline’: [[x0, y0], …], ‘boundary’:
[[x0, y0], …], ‘image’: PIL.Image}.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>A list of dicts {‘text’</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-kraken.lib.segmentation">
<span id="kraken-lib-segmentation-module"></span><h2>kraken.lib.segmentation module<a class="headerlink" href="#module-kraken.lib.segmentation" title="Permalink to this headline">¶</a></h2>
<p>Processing for baseline segmenter output</p>
<dl class="py exception">
<dt class="sig sig-object py" id="kraken.lib.segmentation.KrakenInputException">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.segmentation.</span></span><span class="sig-name descname"><span class="pre">KrakenInputException</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.segmentation.KrakenInputException" title="Permalink to this definition">¶</a></dt>
<dd><p>Common base class for all non-exit exceptions.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.segmentation.LineMCP">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">kraken.lib.segmentation.</span></span><span class="sig-name descname"><span class="pre">LineMCP</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.segmentation.LineMCP" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.segmentation.LineMCP.create_connection">
<span class="sig-name descname"><span class="pre">create_connection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">id1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">id2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pos1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pos2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cost1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cost2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.segmentation.LineMCP.create_connection" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.segmentation.LineMCP.get_connections">
<span class="sig-name descname"><span class="pre">get_connections</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.segmentation.LineMCP.get_connections" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.segmentation.LineMCP.goal_reached">
<span class="sig-name descname"><span class="pre">goal_reached</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">int_index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">float_cumcost</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.segmentation.LineMCP.goal_reached" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.segmentation.boundary_tracing">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.segmentation.</span></span><span class="sig-name descname"><span class="pre">boundary_tracing</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">region</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.segmentation.boundary_tracing" title="Permalink to this definition">¶</a></dt>
<dd><p>Find coordinates of the region’s boundary. The region must not have isolated
points.</p>
<p>Code copied from
<a class="reference external" href="https://github.com/machine-shop/deepwings/blob/master/deepwings/method_features_extraction/image_processing.py#L185">https://github.com/machine-shop/deepwings/blob/master/deepwings/method_features_extraction/image_processing.py#L185</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>region</strong> – object obtained with skimage.measure.regionprops().</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>List of coordinates of pixels in the boundary.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.segmentation.calculate_polygonal_environment">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.segmentation.</span></span><span class="sig-name descname"><span class="pre">calculate_polygonal_environment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">baselines</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">suppl_obj</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">im_feats</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">topline</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.segmentation.calculate_polygonal_environment" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a list of baselines and an input image, calculates a polygonal
environment around each baseline.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>PIL.Image</em>) – grayscale input image (mode ‘L’)</p></li>
<li><p><strong>baselines</strong> (<em>sequence</em>) – List of lists containing a single baseline per
entry.</p></li>
<li><p><strong>suppl_obj</strong> (<em>sequence</em>) – List of lists containing additional polylines
that should be considered hard boundaries for
polygonizaton purposes. Can be used to prevent
polygonization into non-text areas such as
illustrations or to compute the polygonization of
a subset of the lines in an image.</p></li>
<li><p><strong>im_feats</strong> (<em>numpy.array</em>) – An optional precomputed seamcarve energy map.
Overrides data in <cite>im</cite>. The default map is
<cite>gaussian_filter(sobel(im), 2)</cite>.</p></li>
<li><p><strong>scale</strong> (<em>tuple</em>) – A 2-tuple (h, w) containing optional scale factors of
the input. Values of 0 are used for aspect-preserving
scaling. <cite>None</cite> skips input scaling.</p></li>
<li><p><strong>topline</strong> (<em>bool</em>) – Switch to change default baseline location for offset
calculation purposes. If set to False, baselines are
assumed to be on the bottom of the text line and will
be offset upwards, if set to True, baselines are on the
top and will be offset downwards. If set to None, no
offset will be applied.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>List of lists of coordinates. If no polygonization could be compute for
a baseline <cite>None</cite> is returned instead.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.segmentation.compute_polygon_section">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.segmentation.</span></span><span class="sig-name descname"><span class="pre">compute_polygon_section</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">baseline</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">boundary</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.segmentation.compute_polygon_section" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a baseline, polygonal boundary, and two points on the baseline return
the rectangle formed by the orthogonal cuts on that baseline segment. The
resulting polygon is not garantueed to have a non-zero area.</p>
<p>The distance can be larger than the actual length of the baseline if the
baseline endpoints are inside the bounding polygon. In that case the
baseline will be extrapolated to the polygon edge.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>baseline</strong> (<em>list</em>) – A polyline ((x1, y1), …, (xn, yn))</p></li>
<li><p><strong>boundary</strong> (<em>list</em>) – A bounding polygon around the baseline (same format as
baseline).</p></li>
<li><p><strong>dist1</strong> (<em>int</em>) – Absolute distance along the baseline of the first point.</p></li>
<li><p><strong>dist2</strong> (<em>int</em>) – Absolute distance along the baseline of the second point.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A sequence of polygon points.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.segmentation.denoising_hysteresis_thresh">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.segmentation.</span></span><span class="sig-name descname"><span class="pre">denoising_hysteresis_thresh</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">low</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">high</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.segmentation.denoising_hysteresis_thresh" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.segmentation.extract_polygons">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.segmentation.</span></span><span class="sig-name descname"><span class="pre">extract_polygons</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bounds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.segmentation.extract_polygons" title="Permalink to this definition">¶</a></dt>
<dd><p>Yields the subimages of image im defined in the list of bounding polygons
with baselines preserving order.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>PIL.Image.Image</em>) – Input image</p></li>
<li><p><strong>bounds</strong> (<em>list</em>) – A list of tuples (x1, y1, x2, y2)</p></li>
</ul>
</dd>
<dt class="field-even">Yields</dt>
<dd class="field-even"><p>(PIL.Image.Image) the extracted subimage</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>PIL.Image.Image</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.segmentation.is_in_region">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.segmentation.</span></span><span class="sig-name descname"><span class="pre">is_in_region</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">line</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">region</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.segmentation.is_in_region" title="Permalink to this definition">¶</a></dt>
<dd><p>Tests if a line is inside a region, i.e. if the mid point of the baseline
is inside the region.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>line</strong> (<em>geom.LineString</em>) – line to test</p></li>
<li><p><strong>region</strong> (<em>geom.Polygon</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>False if line is not inside region, True otherwise</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.segmentation.line_regions">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.segmentation.</span></span><span class="sig-name descname"><span class="pre">line_regions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">line</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regions</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.segmentation.line_regions" title="Permalink to this definition">¶</a></dt>
<dd><p>Filters a list of regions by line association.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>line</strong> (<em>list</em>) – Polyline representing the line.</p></li>
<li><p><strong>regions</strong> (<em>list</em>) – List of region polygons</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list of regions that contain the line mid-point.</p>
</dd>
</dl>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="kraken.lib.segmentation.logger">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.segmentation.</span></span><span class="sig-name descname"><span class="pre">logger</span></span><a class="headerlink" href="#kraken.lib.segmentation.logger" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.segmentation.moore_neighborhood">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.segmentation.</span></span><span class="sig-name descname"><span class="pre">moore_neighborhood</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">current</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">backtrack</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.segmentation.moore_neighborhood" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.segmentation.polygonal_reading_order">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.segmentation.</span></span><span class="sig-name descname"><span class="pre">polygonal_reading_order</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lines</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">text_direction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'lr'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.segmentation.polygonal_reading_order" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a list of baselines and regions, calculates the correct reading order
and applies it to the input.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lines</strong> (<em>Sequence</em>) – List of tuples containing the baseline and its
polygonization.</p></li>
<li><p><strong>regions</strong> (<em>Sequence</em>) – List of region polygons.</p></li>
<li><p><strong>text_direction</strong> (<em>str</em>) – Set principal text direction for column ordering.
Can be ‘lr’ or ‘rl’</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A reordered input.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Sequence[Tuple[List[Tuple[int, int]], List[Tuple[int, int]]]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.segmentation.reading_order">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.segmentation.</span></span><span class="sig-name descname"><span class="pre">reading_order</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lines</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">text_direction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'lr'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.segmentation.reading_order" title="Permalink to this definition">¶</a></dt>
<dd><p>Given the list of lines (a list of 2D slices), computes
the partial reading order.  The output is a binary 2D array
such that order[i,j] is true if line i comes before line j
in reading order.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lines</strong> (<em>Sequence</em><em>[</em><em>Tuple</em><em>[</em><em>slice</em><em>, </em><em>slice</em><em>]</em><em>]</em>) – </p></li>
<li><p><strong>text_direction</strong> (<em>str</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.segmentation.scale_polygonal_lines">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.segmentation.</span></span><span class="sig-name descname"><span class="pre">scale_polygonal_lines</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lines</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.segmentation.scale_polygonal_lines" title="Permalink to this definition">¶</a></dt>
<dd><p>Scales baselines/polygon coordinates by a certain factor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lines</strong> (<em>Sequence</em>) – List of tuples containing the baseline and it’s
polygonization.</p></li>
<li><p><strong>scale</strong> (<em>float</em><em> or </em><em>tuple of floats</em>) – Scaling factor</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>Sequence[Tuple[List, List]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.segmentation.scale_regions">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.segmentation.</span></span><span class="sig-name descname"><span class="pre">scale_regions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">regions</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.segmentation.scale_regions" title="Permalink to this definition">¶</a></dt>
<dd><p>Scales baselines/polygon coordinates by a certain factor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lines</strong> (<em>Sequence</em>) – List of tuples containing the baseline and it’s
polygonization.</p></li>
<li><p><strong>scale</strong> (<em>float</em><em> or </em><em>tuple of floats</em>) – Scaling factor</p></li>
<li><p><strong>regions</strong> (<em>Sequence</em><em>[</em><em>Tuple</em><em>[</em><em>List</em><em>[</em><em>int</em><em>]</em><em>, </em><em>List</em><em>[</em><em>int</em><em>]</em><em>]</em><em>]</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>Sequence[Tuple[List, List]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.segmentation.topsort">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.segmentation.</span></span><span class="sig-name descname"><span class="pre">topsort</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">order</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.segmentation.topsort" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a binary array defining a partial order (o[i,j]==True means i&lt;j),
compute a topological sort.  This is a quick and dirty implementation
that works for up to a few thousand elements.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>order</strong> (<em>numpy.ndarray</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>List[int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.segmentation.vectorize_lines">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.segmentation.</span></span><span class="sig-name descname"><span class="pre">vectorize_lines</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.17</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_length</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.segmentation.vectorize_lines" title="Permalink to this definition">¶</a></dt>
<dd><p>Vectorizes lines from a binarized array.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>np.ndarray</em>) – Array of shape (3, H, W) with the first dimension
being probabilities for (start_separators,
end_separators, baseline).</p></li>
<li><p><strong>threshold</strong> (<em>float</em>) – Threshold for baseline blob detection.</p></li>
<li><p><strong>min_length</strong> (<em>int</em>) – Minimal length of output baselines.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>[[x0, y0, … xn, yn], [xm, ym, …, xk, yk], … ]
A list of lists containing the points of all baseline polylines.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.segmentation.vectorize_regions">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.segmentation.</span></span><span class="sig-name descname"><span class="pre">vectorize_regions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.segmentation.vectorize_regions" title="Permalink to this definition">¶</a></dt>
<dd><p>Vectorizes lines from a binarized array.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>np.ndarray</em>) – Array of shape (H, W) with the first dimension
being a probability distribution over the region.</p></li>
<li><p><strong>threshold</strong> (<em>float</em>) – Threshold for binarization</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>[[x0, y0, … xn, yn], [xm, ym, …, xk, yk], … ]
A list of lists containing the region polygons.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-kraken.lib.ctc_decoder">
<span id="kraken-lib-ctc-decoder"></span><h2>kraken.lib.ctc_decoder<a class="headerlink" href="#module-kraken.lib.ctc_decoder" title="Permalink to this headline">¶</a></h2>
<p>Decoders for softmax outputs of CTC trained networks.</p>
<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.ctc_decoder.beam_decoder">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.ctc_decoder.</span></span><span class="sig-name descname"><span class="pre">beam_decoder</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beam_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.ctc_decoder.beam_decoder" title="Permalink to this definition">¶</a></dt>
<dd><p>Translates back the network output to a label sequence using
same-prefix-merge beam search decoding as described in [0].</p>
<p>[0] Hannun, Awni Y., et al. “First-pass large vocabulary continuous speech
recognition using bi-directional recurrent DNNs.” arXiv preprint
arXiv:1408.2873 (2014).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output</strong> (<em>numpy.array</em>) – (C, W) shaped softmax output tensor</p></li>
<li><p><strong>outputs</strong> (<em>numpy.ndarray</em>) – </p></li>
<li><p><strong>beam_size</strong> (<em>int</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list with tuples (class, start, end, prob). max is the maximum value
of the softmax layer in the region.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>List[Tuple[int, int, int, float]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.ctc_decoder.blank_threshold_decoder">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.ctc_decoder.</span></span><span class="sig-name descname"><span class="pre">blank_threshold_decoder</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.ctc_decoder.blank_threshold_decoder" title="Permalink to this definition">¶</a></dt>
<dd><p>Translates back the network output to a label sequence as the original
ocropy/clstm.</p>
<p>Thresholds on class 0, then assigns the maximum (non-zero) class to each
region.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output</strong> (<em>numpy.array</em>) – (C, W) shaped softmax output tensor</p></li>
<li><p><strong>threshold</strong> (<em>float</em>) – Threshold for 0 class when determining possible
label locations.</p></li>
<li><p><strong>outputs</strong> (<em>numpy.ndarray</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list with tuples (class, start, end, max). max is the maximum value
of the softmax layer in the region.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>List[Tuple[int, int, int, float]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.ctc_decoder.greedy_decoder">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.ctc_decoder.</span></span><span class="sig-name descname"><span class="pre">greedy_decoder</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outputs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.ctc_decoder.greedy_decoder" title="Permalink to this definition">¶</a></dt>
<dd><p>Translates back the network output to a label sequence using greedy/best
path decoding as described in [0].</p>
<p>[0] Graves, Alex, et al. “Connectionist temporal classification: labelling
unsegmented sequence data with recurrent neural networks.” Proceedings of
the 23rd international conference on Machine learning. ACM, 2006.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output</strong> (<em>numpy.array</em>) – (C, W) shaped softmax output tensor</p></li>
<li><p><strong>outputs</strong> (<em>numpy.ndarray</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list with tuples (class, start, end, max). max is the maximum value
of the softmax layer in the region.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>List[Tuple[int, int, int, float]]</p>
</dd>
</dl>
</dd></dl>

</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/kraken.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">API reference</a><ul>
<li><a class="reference internal" href="#kraken-blla-module">kraken.blla module</a><ul>
<li><a class="reference internal" href="#kraken-blla">kraken.blla</a><ul>
<li><a class="reference internal" href="#kraken.blla.KrakenInputException">KrakenInputException</a></li>
<li><a class="reference internal" href="#kraken.blla.KrakenInvalidModelException">KrakenInvalidModelException</a></li>
<li><a class="reference internal" href="#kraken.blla.calculate_polygonal_environment">calculate_polygonal_environment</a></li>
<li><a class="reference internal" href="#kraken.blla.compute_segmentation_map">compute_segmentation_map</a></li>
<li><a class="reference internal" href="#kraken.blla.get_im_str">get_im_str</a></li>
<li><a class="reference internal" href="#kraken.blla.is_bitonal">is_bitonal</a></li>
<li><a class="reference internal" href="#kraken.blla.logger">logger</a></li>
<li><a class="reference internal" href="#kraken.blla.pil2array">pil2array</a></li>
<li><a class="reference internal" href="#kraken.blla.polygonal_reading_order">polygonal_reading_order</a></li>
<li><a class="reference internal" href="#kraken.blla.scale_polygonal_lines">scale_polygonal_lines</a></li>
<li><a class="reference internal" href="#kraken.blla.scale_regions">scale_regions</a></li>
<li><a class="reference internal" href="#kraken.blla.segment">segment</a></li>
<li><a class="reference internal" href="#kraken.blla.vec_lines">vec_lines</a></li>
<li><a class="reference internal" href="#kraken.blla.vec_regions">vec_regions</a></li>
<li><a class="reference internal" href="#kraken.blla.vectorize_lines">vectorize_lines</a></li>
<li><a class="reference internal" href="#kraken.blla.vectorize_regions">vectorize_regions</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#kraken-pageseg-module">kraken.pageseg module</a><ul>
<li><a class="reference internal" href="#kraken-pageseg">kraken.pageseg</a><ul>
<li><a class="reference internal" href="#kraken.pageseg.KrakenInputException">KrakenInputException</a></li>
<li><a class="reference internal" href="#kraken.pageseg.binary_objects">binary_objects</a></li>
<li><a class="reference internal" href="#kraken.pageseg.compute_black_colseps">compute_black_colseps</a></li>
<li><a class="reference internal" href="#kraken.pageseg.compute_boxmap">compute_boxmap</a></li>
<li><a class="reference internal" href="#kraken.pageseg.compute_colseps_conv">compute_colseps_conv</a></li>
<li><a class="reference internal" href="#kraken.pageseg.compute_gradmaps">compute_gradmaps</a></li>
<li><a class="reference internal" href="#kraken.pageseg.compute_line_seeds">compute_line_seeds</a></li>
<li><a class="reference internal" href="#kraken.pageseg.compute_lines">compute_lines</a></li>
<li><a class="reference internal" href="#kraken.pageseg.compute_separators_morph">compute_separators_morph</a></li>
<li><a class="reference internal" href="#kraken.pageseg.compute_white_colseps">compute_white_colseps</a></li>
<li><a class="reference internal" href="#kraken.pageseg.estimate_scale">estimate_scale</a></li>
<li><a class="reference internal" href="#kraken.pageseg.find">find</a></li>
<li><a class="reference internal" href="#kraken.pageseg.get_im_str">get_im_str</a></li>
<li><a class="reference internal" href="#kraken.pageseg.is_bitonal">is_bitonal</a></li>
<li><a class="reference internal" href="#kraken.pageseg.logger">logger</a></li>
<li><a class="reference internal" href="#kraken.pageseg.norm_max">norm_max</a></li>
<li><a class="reference internal" href="#kraken.pageseg.pil2array">pil2array</a></li>
<li><a class="reference internal" href="#kraken.pageseg.reading_order">reading_order</a></li>
<li><a class="reference internal" href="#kraken.pageseg.record">record</a></li>
<li><a class="reference internal" href="#kraken.pageseg.remove_hlines">remove_hlines</a></li>
<li><a class="reference internal" href="#kraken.pageseg.rotate_lines">rotate_lines</a></li>
<li><a class="reference internal" href="#kraken.pageseg.segment">segment</a></li>
<li><a class="reference internal" href="#kraken.pageseg.topsort">topsort</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#module-kraken.rpred">kraken.rpred module</a><ul>
<li><a class="reference internal" href="#kraken-rpred">kraken.rpred</a><ul>
<li><a class="reference internal" href="#kraken.rpred.KrakenInputException">KrakenInputException</a></li>
<li><a class="reference internal" href="#kraken.rpred.TorchSeqRecognizer">TorchSeqRecognizer</a><ul>
<li><a class="reference internal" href="#kraken.rpred.TorchSeqRecognizer.forward">forward</a></li>
<li><a class="reference internal" href="#kraken.rpred.TorchSeqRecognizer.predict">predict</a></li>
<li><a class="reference internal" href="#kraken.rpred.TorchSeqRecognizer.predict_labels">predict_labels</a></li>
<li><a class="reference internal" href="#kraken.rpred.TorchSeqRecognizer.predict_string">predict_string</a></li>
<li><a class="reference internal" href="#kraken.rpred.TorchSeqRecognizer.to">to</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.rpred.bidi_record">bidi_record</a></li>
<li><a class="reference internal" href="#kraken.rpred.compute_polygon_section">compute_polygon_section</a></li>
<li><a class="reference internal" href="#kraken.rpred.extract_polygons">extract_polygons</a></li>
<li><a class="reference internal" href="#kraken.rpred.generate_input_transforms">generate_input_transforms</a></li>
<li><a class="reference internal" href="#kraken.rpred.get_im_str">get_im_str</a></li>
<li><a class="reference internal" href="#kraken.rpred.is_bitonal">is_bitonal</a></li>
<li><a class="reference internal" href="#kraken.rpred.logger">logger</a></li>
<li><a class="reference internal" href="#kraken.rpred.mm_rpred">mm_rpred</a></li>
<li><a class="reference internal" href="#kraken.rpred.ocr_record">ocr_record</a></li>
<li><a class="reference internal" href="#kraken.rpred.rpred">rpred</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#module-kraken.serialization">kraken.serialization module</a></li>
<li><a class="reference internal" href="#module-kraken.lib.models">kraken.lib.models module</a><ul>
<li><a class="reference internal" href="#kraken-lib-models">kraken.lib.models</a><ul>
<li><a class="reference internal" href="#kraken.lib.models.KrakenInputException">KrakenInputException</a></li>
<li><a class="reference internal" href="#kraken.lib.models.KrakenInvalidModelException">KrakenInvalidModelException</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchSeqRecognizer">TorchSeqRecognizer</a><ul>
<li><a class="reference internal" href="#kraken.lib.models.TorchSeqRecognizer.forward">forward</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchSeqRecognizer.predict">predict</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchSeqRecognizer.predict_labels">predict_labels</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchSeqRecognizer.predict_string">predict_string</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchSeqRecognizer.to">to</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel">TorchVGSLModel</a><ul>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel.input">input</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel.nn">nn</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel.criterion">criterion</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel.user_metdata">user_metdata</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel.one_channel_mode">one_channel_mode</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel.add_codec">add_codec</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel.append">append</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel.build_conv">build_conv</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel.build_dropout">build_dropout</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel.build_groupnorm">build_groupnorm</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel.build_maxpool">build_maxpool</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel.build_output">build_output</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel.build_reshape">build_reshape</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel.build_rnn">build_rnn</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel.eval">eval</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel.get_layer_name">get_layer_name</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel.hyper_params">hyper_params</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel.init_weights">init_weights</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel.load_clstm_model">load_clstm_model</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel.load_model">load_model</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel.load_pronn_model">load_pronn_model</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel.model_type">model_type</a></li>
<li><a class="reference internal" href="#id0">one_channel_mode</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel.resize_output">resize_output</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel.save_model">save_model</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel.seg_type">seg_type</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel.set_layer_name">set_layer_name</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel.set_num_threads">set_num_threads</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel.to">to</a></li>
<li><a class="reference internal" href="#kraken.lib.models.TorchVGSLModel.train">train</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.lib.models.load_any">load_any</a></li>
<li><a class="reference internal" href="#kraken.lib.models.logger">logger</a></li>
<li><a class="reference internal" href="#kraken.lib.models.validate_hyper_parameters">validate_hyper_parameters</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#module-kraken.lib.vgsl">kraken.lib.vgsl module</a></li>
<li><a class="reference internal" href="#module-kraken.lib.xml">kraken.lib.xml module</a></li>
<li><a class="reference internal" href="#module-kraken.lib.codec">kraken.lib.codec</a></li>
<li><a class="reference internal" href="#module-kraken.lib.train">kraken.lib.train module</a></li>
<li><a class="reference internal" href="#module-kraken.binarization">kraken.binarization module</a><ul>
<li><a class="reference internal" href="#kraken-binarization">kraken.binarization</a><ul>
<li><a class="reference internal" href="#kraken.binarization.KrakenInputException">KrakenInputException</a></li>
<li><a class="reference internal" href="#kraken.binarization.array2pil">array2pil</a></li>
<li><a class="reference internal" href="#kraken.binarization.get_im_str">get_im_str</a></li>
<li><a class="reference internal" href="#kraken.binarization.is_bitonal">is_bitonal</a></li>
<li><a class="reference internal" href="#kraken.binarization.logger">logger</a></li>
<li><a class="reference internal" href="#kraken.binarization.nlbin">nlbin</a></li>
<li><a class="reference internal" href="#kraken.binarization.pil2array">pil2array</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#module-kraken.transcribe">kraken.transcribe module</a></li>
<li><a class="reference internal" href="#module-kraken.linegen">kraken.linegen module</a><ul>
<li><a class="reference internal" href="#linegen">linegen</a><ul>
<li><a class="reference internal" href="#kraken.linegen.CairoContext">CairoContext</a></li>
<li><a class="reference internal" href="#kraken.linegen.CairoSurface">CairoSurface</a></li>
<li><a class="reference internal" href="#kraken.linegen.KrakenCairoSurfaceException">KrakenCairoSurfaceException</a><ul>
<li><a class="reference internal" href="#kraken.linegen.KrakenCairoSurfaceException.message">message</a></li>
<li><a class="reference internal" href="#kraken.linegen.KrakenCairoSurfaceException.width">width</a></li>
<li><a class="reference internal" href="#kraken.linegen.KrakenCairoSurfaceException.height">height</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.linegen.LineGenerator">LineGenerator</a><ul>
<li><a class="reference internal" href="#kraken.linegen.LineGenerator.render_line">render_line</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.linegen.PangoContext">PangoContext</a></li>
<li><a class="reference internal" href="#kraken.linegen.PangoFontDescription">PangoFontDescription</a></li>
<li><a class="reference internal" href="#kraken.linegen.PangoLanguage">PangoLanguage</a></li>
<li><a class="reference internal" href="#kraken.linegen.PangoLayout">PangoLayout</a></li>
<li><a class="reference internal" href="#kraken.linegen.PangoRectangle">PangoRectangle</a></li>
<li><a class="reference internal" href="#kraken.linegen.argtypes">argtypes</a></li>
<li><a class="reference internal" href="#id2">argtypes</a></li>
<li><a class="reference internal" href="#id3">argtypes</a></li>
<li><a class="reference internal" href="#id4">argtypes</a></li>
<li><a class="reference internal" href="#id5">argtypes</a></li>
<li><a class="reference internal" href="#id6">argtypes</a></li>
<li><a class="reference internal" href="#id7">argtypes</a></li>
<li><a class="reference internal" href="#id8">argtypes</a></li>
<li><a class="reference internal" href="#id9">argtypes</a></li>
<li><a class="reference internal" href="#id10">argtypes</a></li>
<li><a class="reference internal" href="#id11">argtypes</a></li>
<li><a class="reference internal" href="#id12">argtypes</a></li>
<li><a class="reference internal" href="#id13">argtypes</a></li>
<li><a class="reference internal" href="#id14">argtypes</a></li>
<li><a class="reference internal" href="#id15">argtypes</a></li>
<li><a class="reference internal" href="#id16">argtypes</a></li>
<li><a class="reference internal" href="#id17">argtypes</a></li>
<li><a class="reference internal" href="#id18">argtypes</a></li>
<li><a class="reference internal" href="#kraken.linegen.array2pil">array2pil</a></li>
<li><a class="reference internal" href="#kraken.linegen.c_lib">c_lib</a></li>
<li><a class="reference internal" href="#kraken.linegen.cairo">cairo</a></li>
<li><a class="reference internal" href="#kraken.linegen.degrade_line">degrade_line</a></li>
<li><a class="reference internal" href="#kraken.linegen.distort_line">distort_line</a></li>
<li><a class="reference internal" href="#kraken.linegen.ensureBytes">ensureBytes</a><ul>
<li><a class="reference internal" href="#kraken.linegen.ensureBytes.from_param">from_param</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.linegen.logger">logger</a></li>
<li><a class="reference internal" href="#kraken.linegen.ocropy_degrade">ocropy_degrade</a></li>
<li><a class="reference internal" href="#kraken.linegen.p_lib">p_lib</a></li>
<li><a class="reference internal" href="#kraken.linegen.pango">pango</a></li>
<li><a class="reference internal" href="#kraken.linegen.pangocairo">pangocairo</a></li>
<li><a class="reference internal" href="#kraken.linegen.pc_lib">pc_lib</a></li>
<li><a class="reference internal" href="#kraken.linegen.pil2array">pil2array</a></li>
<li><a class="reference internal" href="#kraken.linegen.restype">restype</a></li>
<li><a class="reference internal" href="#id19">restype</a></li>
<li><a class="reference internal" href="#id20">restype</a></li>
<li><a class="reference internal" href="#id21">restype</a></li>
<li><a class="reference internal" href="#id22">restype</a></li>
<li><a class="reference internal" href="#id23">restype</a></li>
<li><a class="reference internal" href="#id24">restype</a></li>
<li><a class="reference internal" href="#id25">restype</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#module-kraken.lib.dataset">kraken.lib.dataset module</a></li>
<li><a class="reference internal" href="#module-kraken.lib.segmentation">kraken.lib.segmentation module</a></li>
<li><a class="reference internal" href="#module-kraken.lib.ctc_decoder">kraken.lib.ctc_decoder</a><ul>
<li><a class="reference internal" href="#kraken.serialization.is_in_region">is_in_region</a></li>
<li><a class="reference internal" href="#kraken.serialization.logger">logger</a></li>
<li><a class="reference internal" href="#kraken.serialization.make_printable">make_printable</a></li>
<li><a class="reference internal" href="#kraken.serialization.max_bbox">max_bbox</a></li>
<li><a class="reference internal" href="#kraken.serialization.ocr_record">ocr_record</a></li>
<li><a class="reference internal" href="#kraken.serialization.render_report">render_report</a></li>
<li><a class="reference internal" href="#kraken.serialization.serialize">serialize</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.KrakenInvalidModelException">KrakenInvalidModelException</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.PytorchCodec">PytorchCodec</a><ul>
<li><a class="reference internal" href="#kraken.lib.vgsl.PytorchCodec.add_labels">add_labels</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.PytorchCodec.decode">decode</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.PytorchCodec.encode">encode</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.PytorchCodec.is_valid">is_valid</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.PytorchCodec.max_label">max_label</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.PytorchCodec.merge">merge</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel">TorchVGSLModel</a><ul>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel.input">input</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel.nn">nn</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel.criterion">criterion</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel.user_metdata">user_metdata</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel.one_channel_mode">one_channel_mode</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel.add_codec">add_codec</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel.append">append</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel.build_conv">build_conv</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel.build_dropout">build_dropout</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel.build_groupnorm">build_groupnorm</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel.build_maxpool">build_maxpool</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel.build_output">build_output</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel.build_reshape">build_reshape</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel.build_rnn">build_rnn</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel.eval">eval</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel.get_layer_name">get_layer_name</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel.hyper_params">hyper_params</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel.init_weights">init_weights</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel.load_clstm_model">load_clstm_model</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel.load_model">load_model</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel.load_pronn_model">load_pronn_model</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel.model_type">model_type</a></li>
<li><a class="reference internal" href="#id1">one_channel_mode</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel.resize_output">resize_output</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel.save_model">save_model</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel.seg_type">seg_type</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel.set_layer_name">set_layer_name</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel.set_num_threads">set_num_threads</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel.to">to</a></li>
<li><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel.train">train</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.lib.vgsl.logger">logger</a></li>
<li><a class="reference internal" href="#kraken.lib.xml.KrakenInputException">KrakenInputException</a></li>
<li><a class="reference internal" href="#kraken.lib.xml.alto_regions">alto_regions</a></li>
<li><a class="reference internal" href="#kraken.lib.xml.logger">logger</a></li>
<li><a class="reference internal" href="#kraken.lib.xml.page_regions">page_regions</a></li>
<li><a class="reference internal" href="#kraken.lib.xml.parse_alto">parse_alto</a></li>
<li><a class="reference internal" href="#kraken.lib.xml.parse_page">parse_page</a></li>
<li><a class="reference internal" href="#kraken.lib.xml.parse_xml">parse_xml</a></li>
<li><a class="reference internal" href="#kraken.lib.codec.KrakenCodecException">KrakenCodecException</a></li>
<li><a class="reference internal" href="#kraken.lib.codec.KrakenEncodeException">KrakenEncodeException</a></li>
<li><a class="reference internal" href="#kraken.lib.codec.PytorchCodec">PytorchCodec</a><ul>
<li><a class="reference internal" href="#kraken.lib.codec.PytorchCodec.add_labels">add_labels</a></li>
<li><a class="reference internal" href="#kraken.lib.codec.PytorchCodec.decode">decode</a></li>
<li><a class="reference internal" href="#kraken.lib.codec.PytorchCodec.encode">encode</a></li>
<li><a class="reference internal" href="#kraken.lib.codec.PytorchCodec.is_valid">is_valid</a></li>
<li><a class="reference internal" href="#kraken.lib.codec.PytorchCodec.max_label">max_label</a></li>
<li><a class="reference internal" href="#kraken.lib.codec.PytorchCodec.merge">merge</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.lib.codec.logger">logger</a></li>
<li><a class="reference internal" href="#kraken.lib.train.BaselineSet">BaselineSet</a><ul>
<li><a class="reference internal" href="#kraken.lib.train.BaselineSet.add">add</a></li>
<li><a class="reference internal" href="#kraken.lib.train.BaselineSet.transform">transform</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.lib.train.EarlyStopping">EarlyStopping</a><ul>
<li><a class="reference internal" href="#kraken.lib.train.EarlyStopping.trigger">trigger</a></li>
<li><a class="reference internal" href="#kraken.lib.train.EarlyStopping.update">update</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.lib.train.EpochStopping">EpochStopping</a><ul>
<li><a class="reference internal" href="#kraken.lib.train.EpochStopping.trigger">trigger</a></li>
<li><a class="reference internal" href="#kraken.lib.train.EpochStopping.update">update</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.lib.train.GroundTruthDataset">GroundTruthDataset</a><ul>
<li><a class="reference internal" href="#kraken.lib.train.GroundTruthDataset.add">add</a></li>
<li><a class="reference internal" href="#kraken.lib.train.GroundTruthDataset.add_loaded">add_loaded</a></li>
<li><a class="reference internal" href="#kraken.lib.train.GroundTruthDataset.encode">encode</a></li>
<li><a class="reference internal" href="#kraken.lib.train.GroundTruthDataset.no_encode">no_encode</a></li>
<li><a class="reference internal" href="#kraken.lib.train.GroundTruthDataset.parse">parse</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.lib.train.InfiniteDataLoader">InfiniteDataLoader</a></li>
<li><a class="reference internal" href="#kraken.lib.train.KrakenEncodeException">KrakenEncodeException</a></li>
<li><a class="reference internal" href="#kraken.lib.train.KrakenInputException">KrakenInputException</a></li>
<li><a class="reference internal" href="#kraken.lib.train.KrakenTrainer">KrakenTrainer</a><ul>
<li><a class="reference internal" href="#kraken.lib.train.KrakenTrainer.add_lr_scheduler">add_lr_scheduler</a></li>
<li><a class="reference internal" href="#kraken.lib.train.KrakenTrainer.load_model">load_model</a></li>
<li><a class="reference internal" href="#kraken.lib.train.KrakenTrainer.recognition_train_gen">recognition_train_gen</a></li>
<li><a class="reference internal" href="#kraken.lib.train.KrakenTrainer.run">run</a></li>
<li><a class="reference internal" href="#kraken.lib.train.KrakenTrainer.segmentation_train_gen">segmentation_train_gen</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.lib.train.NoStopping">NoStopping</a><ul>
<li><a class="reference internal" href="#kraken.lib.train.NoStopping.trigger">trigger</a></li>
<li><a class="reference internal" href="#kraken.lib.train.NoStopping.update">update</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.lib.train.PolygonGTDataset">PolygonGTDataset</a><ul>
<li><a class="reference internal" href="#kraken.lib.train.PolygonGTDataset.add">add</a></li>
<li><a class="reference internal" href="#kraken.lib.train.PolygonGTDataset.encode">encode</a></li>
<li><a class="reference internal" href="#kraken.lib.train.PolygonGTDataset.no_encode">no_encode</a></li>
<li><a class="reference internal" href="#kraken.lib.train.PolygonGTDataset.parse">parse</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.lib.train.PytorchCodec">PytorchCodec</a><ul>
<li><a class="reference internal" href="#kraken.lib.train.PytorchCodec.add_labels">add_labels</a></li>
<li><a class="reference internal" href="#kraken.lib.train.PytorchCodec.decode">decode</a></li>
<li><a class="reference internal" href="#kraken.lib.train.PytorchCodec.encode">encode</a></li>
<li><a class="reference internal" href="#kraken.lib.train.PytorchCodec.is_valid">is_valid</a></li>
<li><a class="reference internal" href="#kraken.lib.train.PytorchCodec.max_label">max_label</a></li>
<li><a class="reference internal" href="#kraken.lib.train.PytorchCodec.merge">merge</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.lib.train.TrainScheduler">TrainScheduler</a><ul>
<li><a class="reference internal" href="#kraken.lib.train.TrainScheduler.add_phase">add_phase</a></li>
<li><a class="reference internal" href="#kraken.lib.train.TrainScheduler.batch_step">batch_step</a></li>
<li><a class="reference internal" href="#kraken.lib.train.TrainScheduler.epoch_step">epoch_step</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.lib.train.TrainStopper">TrainStopper</a><ul>
<li><a class="reference internal" href="#kraken.lib.train.TrainStopper.trigger">trigger</a></li>
<li><a class="reference internal" href="#kraken.lib.train.TrainStopper.update">update</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.lib.train.annealing_const">annealing_const</a><ul>
<li><a class="reference internal" href="#kraken.lib.train.annealing_const.call_frequency">call_frequency</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.lib.train.annealing_cosine">annealing_cosine</a><ul>
<li><a class="reference internal" href="#kraken.lib.train.annealing_cosine.call_frequency">call_frequency</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.lib.train.annealing_exponential">annealing_exponential</a><ul>
<li><a class="reference internal" href="#kraken.lib.train.annealing_exponential.call_frequency">call_frequency</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.lib.train.annealing_onecycle">annealing_onecycle</a><ul>
<li><a class="reference internal" href="#kraken.lib.train.annealing_onecycle.call_frequency">call_frequency</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.lib.train.annealing_reduceonplateau">annealing_reduceonplateau</a><ul>
<li><a class="reference internal" href="#kraken.lib.train.annealing_reduceonplateau.call_frequency">call_frequency</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.lib.train.annealing_step">annealing_step</a><ul>
<li><a class="reference internal" href="#kraken.lib.train.annealing_step.call_frequency">call_frequency</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.lib.train.baseline_label_evaluator_fn">baseline_label_evaluator_fn</a></li>
<li><a class="reference internal" href="#kraken.lib.train.baseline_label_loss_fn">baseline_label_loss_fn</a></li>
<li><a class="reference internal" href="#kraken.lib.train.collate_sequences">collate_sequences</a></li>
<li><a class="reference internal" href="#kraken.lib.train.compute_error">compute_error</a></li>
<li><a class="reference internal" href="#kraken.lib.train.generate_input_transforms">generate_input_transforms</a></li>
<li><a class="reference internal" href="#kraken.lib.train.logger">logger</a></li>
<li><a class="reference internal" href="#kraken.lib.train.make_printable">make_printable</a></li>
<li><a class="reference internal" href="#kraken.lib.train.preparse_xml_data">preparse_xml_data</a></li>
<li><a class="reference internal" href="#kraken.lib.train.recognition_evaluator_fn">recognition_evaluator_fn</a></li>
<li><a class="reference internal" href="#kraken.lib.train.recognition_loss_fn">recognition_loss_fn</a></li>
<li><a class="reference internal" href="#kraken.lib.train.validate_hyper_parameters">validate_hyper_parameters</a></li>
<li><a class="reference internal" href="#kraken.transcribe.KrakenInputException">KrakenInputException</a></li>
<li><a class="reference internal" href="#kraken.transcribe.TranscriptionInterface">TranscriptionInterface</a><ul>
<li><a class="reference internal" href="#kraken.transcribe.TranscriptionInterface.add_page">add_page</a></li>
<li><a class="reference internal" href="#kraken.transcribe.TranscriptionInterface.write">write</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.transcribe.get_im_str">get_im_str</a></li>
<li><a class="reference internal" href="#kraken.transcribe.logger">logger</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.BaselineSet">BaselineSet</a><ul>
<li><a class="reference internal" href="#kraken.lib.dataset.BaselineSet.add">add</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.BaselineSet.transform">transform</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.lib.dataset.CenterNormalizer">CenterNormalizer</a><ul>
<li><a class="reference internal" href="#kraken.lib.dataset.CenterNormalizer.dewarp">dewarp</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.CenterNormalizer.measure">measure</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.CenterNormalizer.normalize">normalize</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.CenterNormalizer.setHeight">setHeight</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.lib.dataset.GroundTruthDataset">GroundTruthDataset</a><ul>
<li><a class="reference internal" href="#kraken.lib.dataset.GroundTruthDataset.add">add</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.GroundTruthDataset.add_loaded">add_loaded</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.GroundTruthDataset.encode">encode</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.GroundTruthDataset.no_encode">no_encode</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.GroundTruthDataset.parse">parse</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.lib.dataset.InfiniteDataLoader">InfiniteDataLoader</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.KrakenInputException">KrakenInputException</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.PolygonGTDataset">PolygonGTDataset</a><ul>
<li><a class="reference internal" href="#kraken.lib.dataset.PolygonGTDataset.add">add</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.PolygonGTDataset.encode">encode</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.PolygonGTDataset.no_encode">no_encode</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.PolygonGTDataset.parse">parse</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.lib.dataset.PytorchCodec">PytorchCodec</a><ul>
<li><a class="reference internal" href="#kraken.lib.dataset.PytorchCodec.add_labels">add_labels</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.PytorchCodec.decode">decode</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.PytorchCodec.encode">encode</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.PytorchCodec.is_valid">is_valid</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.PytorchCodec.max_label">max_label</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.PytorchCodec.merge">merge</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.lib.dataset.TorchSeqRecognizer">TorchSeqRecognizer</a><ul>
<li><a class="reference internal" href="#kraken.lib.dataset.TorchSeqRecognizer.forward">forward</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.TorchSeqRecognizer.predict">predict</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.TorchSeqRecognizer.predict_labels">predict_labels</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.TorchSeqRecognizer.predict_string">predict_string</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.TorchSeqRecognizer.to">to</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.lib.dataset.calculate_polygonal_environment">calculate_polygonal_environment</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.collate_sequences">collate_sequences</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.compute_confusions">compute_confusions</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.compute_error">compute_error</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.extract_polygons">extract_polygons</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.generate_input_transforms">generate_input_transforms</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.global_align">global_align</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.is_bitonal">is_bitonal</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.logger">logger</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.parse_alto">parse_alto</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.parse_page">parse_page</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.parse_xml">parse_xml</a></li>
<li><a class="reference internal" href="#kraken.lib.dataset.preparse_xml_data">preparse_xml_data</a></li>
<li><a class="reference internal" href="#kraken.lib.segmentation.KrakenInputException">KrakenInputException</a></li>
<li><a class="reference internal" href="#kraken.lib.segmentation.LineMCP">LineMCP</a><ul>
<li><a class="reference internal" href="#kraken.lib.segmentation.LineMCP.create_connection">create_connection</a></li>
<li><a class="reference internal" href="#kraken.lib.segmentation.LineMCP.get_connections">get_connections</a></li>
<li><a class="reference internal" href="#kraken.lib.segmentation.LineMCP.goal_reached">goal_reached</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kraken.lib.segmentation.boundary_tracing">boundary_tracing</a></li>
<li><a class="reference internal" href="#kraken.lib.segmentation.calculate_polygonal_environment">calculate_polygonal_environment</a></li>
<li><a class="reference internal" href="#kraken.lib.segmentation.compute_polygon_section">compute_polygon_section</a></li>
<li><a class="reference internal" href="#kraken.lib.segmentation.denoising_hysteresis_thresh">denoising_hysteresis_thresh</a></li>
<li><a class="reference internal" href="#kraken.lib.segmentation.extract_polygons">extract_polygons</a></li>
<li><a class="reference internal" href="#kraken.lib.segmentation.is_in_region">is_in_region</a></li>
<li><a class="reference internal" href="#kraken.lib.segmentation.line_regions">line_regions</a></li>
<li><a class="reference internal" href="#kraken.lib.segmentation.logger">logger</a></li>
<li><a class="reference internal" href="#kraken.lib.segmentation.moore_neighborhood">moore_neighborhood</a></li>
<li><a class="reference internal" href="#kraken.lib.segmentation.polygonal_reading_order">polygonal_reading_order</a></li>
<li><a class="reference internal" href="#kraken.lib.segmentation.reading_order">reading_order</a></li>
<li><a class="reference internal" href="#kraken.lib.segmentation.scale_polygonal_lines">scale_polygonal_lines</a></li>
<li><a class="reference internal" href="#kraken.lib.segmentation.scale_regions">scale_regions</a></li>
<li><a class="reference internal" href="#kraken.lib.segmentation.topsort">topsort</a></li>
<li><a class="reference internal" href="#kraken.lib.segmentation.vectorize_lines">vectorize_lines</a></li>
<li><a class="reference internal" href="#kraken.lib.segmentation.vectorize_regions">vectorize_regions</a></li>
<li><a class="reference internal" href="#kraken.lib.ctc_decoder.beam_decoder">beam_decoder</a></li>
<li><a class="reference internal" href="#kraken.lib.ctc_decoder.blank_threshold_decoder">blank_threshold_decoder</a></li>
<li><a class="reference internal" href="#kraken.lib.ctc_decoder.greedy_decoder">greedy_decoder</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="api.html" title="previous chapter">API Quickstart</a></li>
      <li>Next: <a href="models.html" title="next chapter">Models</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
<h3>Versions</h3>
<ul>
  <li><a href="../2.0.0/index.html">2.0.0</a></li>
  <li><a href="../3.0/api_docs.html">3.0</a></li>
  <li><a href="api_docs.html">master</a></li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, mittagessen.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/api_docs.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>